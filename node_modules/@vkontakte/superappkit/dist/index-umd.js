!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).SuperAppKit={})}(this,(function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=["vk.com","vk.ru"],r=["agreements","promo","vkc_behavior","vkc_auth_action","vkc_brand","vkc_display_mode","service_groups","external_device_id"],o=0,i=1,a=3,s=4,c=6,u=15,l=16,p=82,d=!("undefined"==typeof window||!window.document||!window.document.createElement),h=d&&!!window.addEventListener,f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function v(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function m(e,t){return e(t={exports:{}},t.exports),t.exports}var g=v(m((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}))),E=function(){};if(h)try{var _=Object.defineProperty({},"passive",{get:function(){!0}});window.addEventListener("test",E,_),window.removeEventListener("test",E,_)}catch(e){}!function(){if(!d)return!1;var e=!1;try{document.createElement("div").scrollTo({top:0,get behavior(){return e=!0,"smooth"}})}catch(e){}}();var A=m((function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0}));v(A);var y=m((function(e){e.exports=function(e){if(Array.isArray(e))return A(e)},e.exports.default=e.exports,e.exports.__esModule=!0}));v(y);var S=m((function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0}));v(S);var T=m((function(e){e.exports=function(e,t){if(e){if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0}));v(T);var D=m((function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}));v(D),v(m((function(e){e.exports=function(e){return y(e)||S(e)||T(e)||D()},e.exports.default=e.exports,e.exports.__esModule=!0})));var C=v(m((function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0})));function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P={parse:function(e){if("string"!=typeof e)return{};if(!(e=e.trim().replace(/^[?#&]/,"")))return{};var t=/\?(.+)$/gi.exec(e);return(t?t[1]:e).split("&").reduce((function(e,t){var n=t.split("=");return n[1]&&(e[n[0]]=decodeURIComponent(n[1])),e}),{})},stringify:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==g(e)||null===e)return"";t=w({encode:!0},t);var n=function(e){return t.encode?encodeURIComponent(e):String(e)};return Object.keys(e).reduce((function(r,o){var i=e[o];return void 0===i?r:null===i?(t.skipNull||r.push([n(o),""].join("=")),r):Array.isArray(i)?(i.map((function(e){r.push("".concat(n(o),"[]=").concat(n(e)))})).join(),r):(r.push([n(o),n(i)].join("=")),r)}),[]).join("&")}};v(m((function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0}))),v(m((function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0})));let b=(e=21)=>{let t="",n=e;for(;n--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t};var K,I=(K=Object.freeze({__proto__:null,default:{}}))&&K.default||K,N=m((function(e,t){var n;e.exports=(n=n||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==f&&f.crypto&&(n=f.crypto),!n)try{n=I}catch(e){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},a=i.lib={},s=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var a=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=a<<24-(r+i)%4*8}else for(var s=0;s<o;s+=4)t[r+s>>>2]=n[s>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new c.init(t,e)}}),u=i.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},p=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},d=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},h=a.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,o=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,l=e.min(4*u,i);if(u){for(var p=0;p<u;p+=a)this._doProcessBlock(o,p);n=o.splice(0,u),r.sigBytes-=l}return new c.init(n,l)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),v=(a.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new v.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math),n)})),k=m((function(e,t){var n;e.exports=(n=N,function(e){var t=n,r=t.lib,o=r.WordArray,i=r.Hasher,a=t.algo,s=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,o=0;o<64;)t(r)&&(o<8&&(s[o]=n(e.pow(r,.5))),c[o]=n(e.pow(r,1/3)),o++),r++}();var u=[],l=a.SHA256=i.extend({_doReset:function(){this._hash=new o.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],l=n[5],p=n[6],d=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var f=u[h-15],v=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,m=u[h-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[h]=v+u[h-7]+g+u[h-16]}var E=r&o^r&i^o&i,_=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),A=d+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&p)+c[h]+u[h];d=p,p=l,l=s,s=a+A|0,a=i,i=o,o=r,r=A+(_+E)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+p|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(l),t.HmacSHA256=i._createHmacHelper(l)}(Math),n.SHA256)})),R=m((function(e,t){var n,r,o;e.exports=(r=(n=o=N).lib.WordArray,n.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var o=[],i=0;i<n;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<n;s++)o.push(r.charAt(a>>>6*(3-s)&63));var c=r.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var a=n.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,n){for(var o=[],i=0,a=0;a<t;a++)if(a%4){var s=n[e.charCodeAt(a-1)]<<a%4*2,c=n[e.charCodeAt(a)]>>>6-a%4*2,u=s|c;o[i>>>2]|=u<<24-i%4*8,i++}return r.create(o,i)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)}));function M(e){return P.stringify(e,{skipNull:!0})}function x(e){return Object.keys(e).filter((function(e){return r.includes(e)}))}function L(e){var t;return Boolean(null===(t=x(e))||void 0===t?void 0:t.length)}function V(e){var t=function(e){return x(e).reduce((function(t,n){return t[n]=e[n],t}),{})}(e);return btoa(JSON.stringify(t))}function U(e,t){var n,r,o=document.createElement("iframe");for(var i in e&&(o.src=e),o.style.cssText=null!==(n=null==t?void 0:t.cssText)&&void 0!==n?n:"",o.width="100%",o.height="100%",o.style.border="none",null==t?void 0:t.properties)t&&t.properties.hasOwnProperty(i)&&(o[i]=null!==(r=t.properties[i])&&void 0!==r?r:"");return o}function H(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(e){return e&&"object"===t(e)};return e.reduce((function(e,t){return Object.keys(t).forEach((function(n){var o=e[n],i=t[n];Array.isArray(o)&&Array.isArray(i)?e[n]=o.concat.apply(o,i):r(o)&&r(i)?e[n]=H(o,i):e[n]=i})),e}),{})}function G(e,t){return void 0===e?t:"number"!=typeof e?e?1:0:e}function B(e,n){return e&&"object"===t(e)?Object.keys(e).reduce((function(t,r){return n.includes(r)?(t[r]=e[r],t):t}),{}):e}var z,F,W,j=function(e){var t=k(e);return R.stringify(t).replace(/=*$/g,"").replace(/\+/g,"-").replace(/\//g,"_")},Y=function(){return b().replace("-","").replace("_","")},q=new(function(){function e(){this.savedStyles=[],this.bodyScrollYValue=0,this.isFreezed=!1}return e.prototype.freezeBodyOverflow=function(){if(!this.isFreezed){this.isFreezed=!0;var e=(n=window.document.documentElement.clientWidth,Math.abs(window.innerWidth-n)),t=parseInt(window.getComputedStyle(window.document.body).paddingRight,10)||0;this.bodyScrollYValue=window.pageYOffset||window.scrollY,this.savedStyles=[],this.savedStyles.push({value:window.document.body.style.paddingRight,property:"padding-right"},{value:window.document.body.style.overflow,property:"overflow"},{value:window.document.body.style.overflowX,property:"overflow-x"},{value:window.document.body.style.overflowY,property:"overflow-y"}),window.document.body.style.setProperty("overflow","hidden"),window.document.body.style.setProperty("padding-right",e+t+"px")}var n},e.prototype.restoreBodyOverflow=function(){this.isFreezed&&(this.savedStyles.forEach((function(e){var t=e.value,n=e.property;t?window.document.body.style.setProperty(n,t):window.document.body.style.removeProperty(n)})),window.scrollTo(0,this.bodyScrollYValue),this.isFreezed=!1)},e}());(z=e.CommonSDKEvents||(e.CommonSDKEvents={})).OPEN="VKSDKOpen",z.CLOSE="VKSDKClose",z.LOGOUT="VKSDKLogout",z.GET_CAPTCHA="VKSDKGetCaptcha",z.CAPTCHA_SUCCESS="VKSDKGetCaptchaSuccess",z.CAPTCHA_FAILED="VKSDKGetCaptchaFail",z.AUTH_NEEDED="VKSDKAuthNeeded",z.UPDATE_PARAMS="VKSDKUpdateParams",z.REQUEST_SUPERAPP_TOKEN="VKSDKRequestSuperAppToken",z.ERROR="VKSDKError",function(e){e.INIT="VKSDKInit"}(F||(F={})),(W=e.SDKErrorCodes||(e.SDKErrorCodes={}))[W.UNKNOWN=1]="UNKNOWN",W[W.MISSING_PARAM=2]="MISSING_PARAM",W[W.CONNECTION_LOST=3]="CONNECTION_LOST",W[W.USER_DENIED=4]="USER_DENIED",W[W.INVALID_PARAMS=5]="INVALID_PARAMS",W[W.CUSTOM=6]="CUSTOM",W[W.LOADING_ERROR=7]="LOADING_ERROR",W[W.CONNECT_WINDOW_CLOSED=7]="CONNECT_WINDOW_CLOSED",W[W.CONNECT_WINDOW_NOT_OPENED=8]="CONNECT_WINDOW_NOT_OPENED",W[W.CONNECT_DOMAIN_NOT_ALLOWED=9]="CONNECT_DOMAIN_NOT_ALLOWED",W[W.CONNECT_UNKNOWN_SDK_MESSAGE=10]="CONNECT_UNKNOWN_SDK_MESSAGE",W[W.CONNECT_CLIENT_SDK_ERROR=11]="CONNECT_CLIENT_SDK_ERROR",W[W.VALIDATE_ERROR=12]="VALIDATE_ERROR",W[W.CAPTCHA_ERROR=14]="CAPTCHA_ERROR",W[W.OLD_MISSING_PARAM=100]="OLD_MISSING_PARAM";var Z=function(e,t){return'Wrong "'+e+'" param. '+(t||"")},Q=function(){return"Connect window was closed."},J=function(){return"Connect window was not opened."},X=function(e){return'URL domain "'+e+'" is not allowed.'},$=function(e){return"This SDK message is unknown: "+e},ee=function(e){return e.error+";"+e.errorCode},te=function(){return"Loading timeout"},ne=function(e){return"The "+e+" parameter must be a number"},re=function(e){return"The "+e+" parameter must be a string"},oe=function(e){return"The "+e+" is required parameter"},ie=function(e){return"The "+e+" parameter must be a number or a string"},ae=function(e){return"The "+e+" parameter must be а function"},se=function(e,t){return(se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation.

  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.

  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** */function ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}se(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var ue,le,pe,de,he=function(){return(he=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function fe(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map((function(e){e(n)})),(e["*"]||[]).slice().map((function(e){e(t,n)}))}}}function ve(e){return"number"==typeof e}function me(e){return"string"==typeof e}function ge(e){return void 0!==e&&""!==e&&null!==e}function Ee(e){return"function"==typeof e}function _e(e,t,n,r){return{type:e,code:t,message:n,params:r}}function Ae(t,n){return{type:e.SDKErrorCodes[e.SDKErrorCodes.VALIDATE_ERROR],code:e.SDKErrorCodes.VALIDATE_ERROR,message:t,params:n}}function ye(e){return e.message?{code:e.code,reason:e.message,data:e.params}:{code:e.code,data:e.params}}!function(e){e.GET_CAPTCHA="VKSDKGetCaptcha",e.APP_CLOSE="VKWebAppClose",e.APP_READY="VKSDKMiniAppReady",e.RESIZE="VKSDKMiniAppResize",e.APP_INIT_CONFIG="VKSDKMiniAppInitConfig",e.OPEN_APP="VKWebAppOpenApp",e.OPEN_PAY_FORM="VKWebAppOpenPayForm",e.ACTION_DONE="VKWebAppActionDone",e.SET_TITLE="VKWebAppSetTitle",e.AUTH_BY_EXCHANGE_TOKEN="VKWebAppAuthByExchangeToken",e.FORCE_LOGOUT="VKWebAppForceLogout"}(ue||(ue={})),(le=e.MiniAppEvents||(e.MiniAppEvents={})).OPEN="open",le.HIDE="hide",le.CLOSE="close",le.SHOW="show",le.MESSAGE="message",le.CREATE_APP="createapp",function(e){e.SUPERAPP_TOKEN="VKSDKGeneralSuperAppToken",e.AUTH_NEEDED="VKSDKGeneralAuthNeeded",e.OPEN_APP="VKSDKGeneralOpenApp"}(pe||(pe={})),function(e){e.SUPERAPP_TOKEN_CHANGE_V2="superAppTokenV2",e.SUPERAPP_TOKEN_CHANGE="superAppToken"}(de||(de={}));var Se,Te=function(){function e(e,t,n){void 0===e&&(e="Parameter validation error"),this.errorText=e,this.params=t,this.valid=n}return e.prototype.isValid=function(){return Boolean(this.valid)},e.prototype.error=function(e){return this.isValid()?null:e?ye(Ae(this.errorText,this.params)):Ae(this.errorText,this.params)},e}(),De=function(){function e(e){this.rules=e}return e.prototype.validate=function(e){for(var t in this.rules)if(this.rules.hasOwnProperty(t))for(var n=0;n<this.rules[t].length;n++){var r=this.rules[t][n];if(!r.rule(e[t]))return new Te(r.errorText,e,!1)}return new Te("",e,!0)},e}(),Ce=(new De({params:[{rule:ge,errorText:oe("params")}]}),new De({token:[{rule:me,errorText:re("token")}]})),Oe=new De({event:[{rule:me,errorText:re("event")},{rule:ge,errorText:oe("event")}],handler:[{rule:ge,errorText:oe("handler")}]}),we=new De({app:[{rule:function(e){return ve(e)||me(e)},errorText:ie("app")},{rule:ge,errorText:oe("app")}]}),Pe=new De({message:[{rule:ge,errorText:oe("message")}]}),be=new De({handler:[{rule:ge,errorText:oe("handler")},{rule:Ee,errorText:ae("handler")}]}),Ke=new De({handler:[{rule:ge,errorText:oe("handler")},{rule:Ee,errorText:ae("handler")}]}),Ie=new De({handler:[{rule:ge,errorText:oe("handler")},{rule:Ee,errorText:ae("handler")}]}),Ne=new De({appId:[{rule:ve,errorText:ne("appId")}]}),ke={appId:0,superAppToken:"",superAppTokenV2:"",loginDomain:"login.vk.com",oauthDomain:"oauth.vk.com",connectDomain:"id.vk.com",_debug:!1,_localhost:!1},Re={},Me=function(){function e(){}return e.init=function(e){if(!e.appId)throw new Error("appId required");var t=Ne.validate({appId:e.appId});!t.isValid()&&console.error(t.error()),ke.appId=e.appId,ke.superAppToken=e.superAppToken||"",ke.superAppTokenV2=e.superAppTokenV2||"",ke.loginDomain=e.loginDomain||"login.vk.com",ke.oauthDomain=e.oauthDomain||"oauth.vk.com",ke.connectDomain=e.connectDomain||"id.vk.com",ke.appSettings=e.appSettings,ke._debug=!!e._debug,ke._localhost=!!e._localhost},e.get=function(){return ke},e.setSuperAppToken=function(t,n){void 0===n&&(n={});var r=Ce.validate({token:t});!r.isValid()&&console.error(r.error()),2===n.version?(ke.superAppTokenV2=t,e.events.emit(de.SUPERAPP_TOKEN_CHANGE_V2,t)):(ke.superAppToken=t,e.events.emit(de.SUPERAPP_TOKEN_CHANGE,t))},e.onRequestSuperAppToken=function(e){var t=be.validate({handler:e});!t.isValid()&&console.error(t.error()),Re.requestSuperAppToken=e},e._requestSuperAppToken=function(t,n){var r;void 0===n&&(n={}),Re.requestSuperAppToken&&(r=Re.requestSuperAppToken(t,n)),r&&r.then((function(t){return e.setSuperAppToken(t,n)})).catch(console.error)},e.onAuth=function(e){var t=Ke.validate({handler:e});!t.isValid()&&console.error(t.error()),Re.auth=e},e._auth=function(t){var n;void 0===t&&(t={}),Re.auth&&(n=Re.auth()),n&&n.then((function(n){e.setSuperAppToken(n,t)})).catch(console.error)},e.onOpenApp=function(e){Re.openApp=e},e._openApp=function(e){Re.openApp&&Re.openApp(e.app)},e.onLogout=function(e){var t=Ie.validate({handler:e});!t.isValid()&&console.error(t.error()),Re.logout=e},e._logout=function(){Re.logout&&Re.logout()},e.fetchDomain=function(){return Boolean(Se)||(Se=new Promise((function(e){fetch("https://vk.ru/domain.txt").then((function(e){return e.text()})).then((function(e){return e.trim()})).then((function(e){ke.loginDomain=ke.loginDomain.replace("vk.com",e),ke.oauthDomain=ke.oauthDomain.replace("vk.com",e),ke.connectDomain=ke.connectDomain.replace("vk.com",e)})).then(e).catch((function(t){e(),console.warn(t)}))}))),Se},e.events=fe(),e}(),xe=new De({iframe:[{rule:ge,errorText:oe("iframe")}],origin:[{rule:me,errorText:re("origin")},{rule:ge,errorText:oe("origin")}]}),Le=new De({event:[{rule:ge,errorText:oe("event")}]}),Ve=new De({handler:[{rule:ge,errorText:oe("handler")},{rule:Ee,errorText:ae("handler")}]}),Ue=new De({handler:[{rule:ge,errorText:oe("handler")}],params:[{rule:ge,errorText:oe("params")}]}),He=function(e){var t=this;this.handler=function(){return{}},this.destroy=function(){delete t.config,window.removeEventListener("message",t.handleMessage)},this.onMessage=function(e){var n=Ve.validate({handler:e});!n.isValid()&&console.error(n.error()),t.handler=e},this.sendMessage=function(e){var n,r=Ue.validate(e);!r.isValid()&&console.error(r.error()),null===(n=t.config.iframe.contentWindow)||void 0===n||n.postMessage(he({type:"vk-sak-sdk"},e),t.config.origin)},this.handleMessage=function(e){var n=Le.validate({event:e});!n.isValid()&&console.error(n.error()),t.config.origin&&e.origin===t.config.origin&&e.source===t.config.iframe.contentWindow&&e.data&&"vk-sak-sdk"===e.data.type&&t.handler(e.data)};var n=xe.validate(e);!n.isValid()&&console.error(n.error()),this.config=e,window.addEventListener("message",this.handleMessage)},Ge=function(){function e(){var e=this;this.resolve=function(t){if(Boolean(e.promise))return e.finished=!0,e.active=!1,e.resolveHandler(t)},this.reject=function(t){if(Boolean(e.promise))return e.finished=!0,e.active=!1,e.rejectHandler(t)}}return e.prototype.start=function(){var e=this;this.active=!0,this.finished=!1,this.promise=new Promise((function(t,n){e.resolveHandler=t,e.rejectHandler=n}))},e.prototype.get=function(){return this.promise},e}(),Be=["extend_token","login_with_user","login_silent_user","__sferum_invite_link","registration_with_phone","registration_with_email","validate_phone","bind_ok_account","no_password_flow","confirm_service_action","login_with_eljour","login_with_edu_profile","login_with_multi_user","auth_validation_phone","qr_auth","multi_account_flow"];function ze(e){return e&&Be.includes(e.name)?btoa(JSON.stringify(e)):""}function Fe(e){return e?btoa(JSON.stringify(e)):""}function We(e,t){return void 0===t&&(t="auth"),Me.fetchDomain().then((function(){var n=Me.get(),r=n.appId,o=n.connectDomain,i=n.appSettings,a=n._debug,s=n._localhost,c=he({app_id:r,response_type:"silent_token",v:"1.60.0",debug:a?1:null,localhost:s?1:null},e);i&&L(i)&&(c.app_settings=V(i));var u=M(c);return Promise.resolve("https://"+o+"/"+t+"?"+u)}))}var je,Ye=[o,i,a,s,c,u,l,p];!function(e){e.Default="default",e.NamePhone="name_phone",e.PhoneName="phone_name"}(je||(je={}));var qe,Ze=[je.Default,je.NamePhone,je.PhoneName];!function(e){e.Primary="primary",e.Flat="flat"}(qe||(qe={}));var Qe=[qe.Primary,qe.Flat];var Je;(Je=e.AuthCaptchaEventsSDK||(e.AuthCaptchaEventsSDK={})).CAPTCHA_SUCCESS="VKSDKAuthCaptchaSuccess",Je.CAPTCHA_FAIL="VKSDKAuthCaptchaFail";var Xe,$e=function(t,n,r){var o=this;this.events=fe(),this.showReadyPromiseTask=new Ge,this.init=function(){Me.fetchDomain().then((function(){We(he(he({origin:location.protocol+"//"+location.host,uuid:o.uuid},o.captchaData),{scheme:o.scheme}),"auth_captcha").then(o.handleCaptcha)}))},this.createFrame=function(){return o.iframe=U("",{cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100vh;\n      min-height: 100vh;\n      border: none;\n      z-index: 99999;\n     "}),o},this.handleError=function(t){var n=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CUSTOM],e.SDKErrorCodes.CUSTOM,"",t));o.events.emit(e.CommonSDKEvents.ERROR,n)},this.onMessage=function(t){switch(t.handler){case e.CommonSDKEvents.ERROR:o.handleError(t.params);break;case e.AuthCaptchaEventsSDK.CAPTCHA_SUCCESS:o.showReadyPromiseTask.resolve(t.params),o.destroy();break;default:o.showReadyPromiseTask.reject(),o.destroy()}},this.handleCaptcha=function(e){o.iframe.src=e,document.body.appendChild(o.iframe),o.bridge=new He({iframe:o.iframe,origin:"https://"+Me.get().connectDomain}),o.bridge.onMessage(o.onMessage)},this.destroy=function(){o.iframe&&document.body.removeChild(o.iframe),o.bridge&&o.bridge.destroy()},this.show=function(){return o.iframe.style.display="block",new Promise((function(e){o.showReadyPromiseTask.start(),o.showReadyPromiseTask.get().then(e)}))},this.uuid=t,this.captchaData=n,this.scheme=r||"bright_light",this.createFrame().init()},et=function(){function t(n){var r=this;this.readyPromiseResolve=null,this.readyPromise=null,this.child=null,this.initialTitle=window.document.title,this.open=function(e,t){return Me.fetchDomain().then((function(){return r.loading?(r.getMiniAppUrl(e,t).then((function(e){r.iframe.src=e})),r.loading=new Promise((function(e){r.iframe.onload=function(){r.iframe.onload=null,e()}})),r.readyPromise=new Promise((function(e){return r.readyPromiseResolve=e})),r.eventOpenSettings(),r.readyPromise):r.preload(e,t).catch(console.error)}))},this.eventOpenSettings=function(){r.iframe.style.display="block",r.params.stackMode||q.freezeBodyOverflow(),r.loading.then(r.handleResize).catch(console.error),r.events.emit(e.MiniAppEvents.OPEN)},this.hide=function(){r.iframe.style.display="none",r.params.stackMode||q.restoreBodyOverflow(),r.events.emit(e.MiniAppEvents.HIDE)},this.close=function(t){window.document.title!==r.initialTitle&&(window.document.title=r.initialTitle),r.params.stackMode||q.restoreBodyOverflow(),r.iframe&&r.iframe.remove(),r.bridge&&r.bridge.destroy(),delete r.iframe,delete r.bridge,Me.events.off(de.SUPERAPP_TOKEN_CHANGE,r.onSuperAppToken),window.removeEventListener("resize",r.handleResize),r.events.emit(e.MiniAppEvents.CLOSE,t)},this.show=function(){if(!r.loading)throw new Error('App is not loaded, use "open" or "preload" methods');r.iframe.style.display="block",r.params.stackMode||q.freezeBodyOverflow(),r.events.emit(e.MiniAppEvents.SHOW)},this.preload=function(e,t){return Me.fetchDomain().then((function(){var n=document.createElement("iframe"),o=window.innerHeight,i=isFinite(r.params.zIndex)?r.params.zIndex:999999;return r.getMiniAppUrl(e,t).then((function(e){n.src=e})),n.setAttribute("allow","geolocation"),n.style.cssText="\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+o+"px;\n      min-height: "+o+"px;\n      border: none;\n      z-index: "+i+";\n    ",r.iframe=n,document.body.appendChild(r.iframe),r.bridge=new He({iframe:r.iframe,origin:"https://"+Me.get().connectDomain}),r.loading=new Promise((function(e){n.onload=function(){n.onload=null,e()}})),r.readyPromise=new Promise((function(e){return r.readyPromiseResolve=e})),r.bridge.onMessage(r.handleMessage),Me.events.on(de.SUPERAPP_TOKEN_CHANGE,r.onSuperAppToken),window.addEventListener("resize",r.handleResize),r.eventOpenSettings(),r.loading}))},this.sendMessage=function(e){var t=Pe.validate({message:e});!t.isValid()&&console.error(t.error()),r.bridge.sendMessage(e)},this.onSuperAppToken=function(e){r.bridge.sendMessage({handler:pe.SUPERAPP_TOKEN,params:{result:e}})},this.handleError=function(t){var n=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CUSTOM],e.SDKErrorCodes.CUSTOM,"",t));r.events.emit(e.CommonSDKEvents.ERROR,n)},this.handleMessage=function(t){switch(t.handler){case e.CommonSDKEvents.GET_CAPTCHA:var n=t.params.uuid,o=new $e(n,{captcha_sid:t.params.captcha_sid,captcha_img:t.params.captcha_img});o.show().then((function(t){r.bridge.sendMessage({handler:e.CommonSDKEvents.CAPTCHA_SUCCESS,params:he({uuid:n},t)})})).catch((function(){r.bridge.sendMessage({handler:e.CommonSDKEvents.CAPTCHA_FAILED,params:{uuid:n}}),o.destroy()}));break;case ue.APP_CLOSE:r.hide();break;case e.CommonSDKEvents.ERROR:r.handleError(t.params);break;case ue.APP_READY:r.resolveReadyPromise(),r.handleUpdateConfig();break;case ue.OPEN_APP:r.openMiniapp(t.params);break;case ue.OPEN_PAY_FORM:r.openPayForm(t.params);break;case ue.SET_TITLE:r.setTitle(t.params);break;case ue.AUTH_BY_EXCHANGE_TOKEN:r.onAuthByExchangeToken();break;case ue.FORCE_LOGOUT:r.onForceLogout();break;case pe.SUPERAPP_TOKEN:Me._requestSuperAppToken(t.params);break;case pe.AUTH_NEEDED:Me._auth();break;default:r.events.emit(e.MiniAppEvents.MESSAGE,t)}},this.handleResize=function(){if(r.iframe){var e=innerWidth,t=innerHeight;r.iframe.style.height=t+"px",r.iframe.style.minHeight=t+"px",r.bridge.sendMessage({handler:ue.RESIZE,params:{viewport_width:e,viewport_height:t}})}},this.handleUpdateConfig=function(){r.bridge.sendMessage({handler:ue.APP_INIT_CONFIG,params:{fullMode:r.params.fullMode,hideMenu:r.params.hideMenu,scheme:r.params.scheme}})},this.update=function(e){e&&(r.params=H(r.params,e||{}),r.sendUpdateParamsMessage())},this.getMiniAppUrl=function(e,t){return Me.fetchDomain().then((function(){var n=Me.get(),o=n.connectDomain,i=n.appId,a=n.superAppToken,s=n._debug,c=n._localhost;return"https://"+o+"/mini_app?"+M({app:r.params.app,host_app_id:i,superapp_token:a,app_query:e?JSON.stringify(e):"",app_hash:t||"",debug:s?1:null,localhost:c?1:null})}))},this.resolveReadyPromise=function(){r.readyPromise&&r.readyPromiseResolve&&(r.readyPromiseResolve(),r.readyPromise=null,r.readyPromiseResolve=null)},this.openMiniapp=function(n){r.child=new t({app:n.app_id,stackMode:r.params.stackMode}),r.events.emit(e.MiniAppEvents.CREATE_APP,{app:r.child,location:n.location})},this.openPayForm=function(n){var o=he({},n.params);o.data&&(o.data=JSON.stringify(o.data));var i=he(he({},o),{app_id:n.app_id,action:n.action}),a=new t({app:6217559,stackMode:r.params.stackMode});a.open(i).then((function(){return r.hide()})).catch(console.error),a.events.on(e.MiniAppEvents.MESSAGE,(function(e){r.handleVKPayFormMessage(e),a.close(),r.show()})),a.events.on(e.MiniAppEvents.HIDE,(function(){a.close(),r.close()}))},this.setTitle=function(e){window.document.title=e.title},this.onAuthByExchangeToken=function(){r.close({closedByExchangeToken:!0})},this.onForceLogout=function(){r.close({closedByForceLogout:!0})},this.handleVKPayFormMessage=function(t){t.handler===ue.ACTION_DONE&&r.sendMessage(t),t.handler===e.CommonSDKEvents.ERROR&&r.handleError(t.params)};var o=we.validate(n);!o.isValid()&&console.error(o.error()),this.params=he(he({},n),{app:"number"==typeof n.app?"app"+n.app:n.app,scheme:"string"==typeof n.scheme?n.scheme:"bright_light"}),this.events=fe()}return t.prototype.on=function(e,t){var n=Oe.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},t.prototype.off=function(e,t){var n=Oe.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},t.prototype.sendUpdateParamsMessage=function(){this.bridge&&this.bridge.sendMessage({params:this.params,handler:e.CommonSDKEvents.UPDATE_PARAMS})},t}(),tt=function(){function t(){this.stack=[]}return t.prototype.removeMiniApp=function(e){var t=e.app,n=this.stack.lastIndexOf(t);if(n>-1&&n===this.stack.length-1)if(this.stack.splice(n,1),this.stack.length){this.stack[this.stack.length-1].show();var r=this.stack[this.stack.length-2];setTimeout((function(){return null==r?void 0:r.hide()}),0)}else q.restoreBodyOverflow()},t.prototype.makeHandleMiniAppClose=function(e){var t=this,n=e.app;return function(){t.removeMiniApp({app:n})}},t.prototype.makeHandleMiniAppHide=function(e){var t=this,n=e.app;return function(){var e=t.stack.lastIndexOf(n);e>-1&&e===t.stack.length-1&&setTimeout((function(){return n.close()}),0)}},t.prototype.handleMiniAppCreate=function(t){var n=t.app,r=t.query,o=t.hash;this.stack.push(n),n.open(r,o).catch(console.error),n.events.on(e.MiniAppEvents.CREATE_APP,this.handleMiniAppCreate.bind(this)),n.events.on(e.MiniAppEvents.HIDE,this.makeHandleMiniAppHide({app:n})),n.events.on(e.MiniAppEvents.CLOSE,this.makeHandleMiniAppClose({app:n})),q.freezeBodyOverflow();var i=this.stack[this.stack.length-2];return setTimeout((function(){null==i||i.hide()}),0),n},Object.defineProperty(t.prototype,"length",{get:function(){return this.stack.length},enumerable:!1,configurable:!0}),t.prototype.open=function(e){var t=we.validate(e);!t.isValid()&&console.error(t.error());var n=e.app,r=e.query,o=e.hash,i=new et({app:n,stackMode:!0});return this.handleMiniAppCreate({app:i,query:r,hash:o}),i},t.prototype.close=function(){var e=this.stack;this.stack.splice(0),e.reverse().forEach((function(e){return e.close()})),q.restoreBodyOverflow()},t}();(Xe=e.GeoserviceEvents||(e.GeoserviceEvents={})).STATIC_MAP="VKSDKRequestToGeoservice:staticmap/png/",Xe.SEARCH="VKSDKRequestToGeoservice:search",Xe.OVERALL="VKSDKRequestToGeoservice:overall",Xe.DIRECTIONS="VKSDKRequestToGeoservice:directions",Xe.ISO="VKSDKRequestToGeoservice:iso";var nt,rt,ot,it,at,st,ct=function(){function e(e){var t=this;this.apiKey=e.apiKey,this.requestMap={};var n=document.createElement("iframe");this.iframe=n,Me.fetchDomain().then((function(){var e=Me.get().appId;t.getGeoserviceProxyUrl({app_id:e}).then((function(e){n.src=e})),n.style.cssText="\n      display: none;\n    ",document.body.appendChild(t.iframe),t.bridge=new He({iframe:t.iframe,origin:"https://"+Me.get().connectDomain}),t.bridge.onMessage((function(e){var n=e.params,r=n.requestID,o=n.response;t.requestMap[r].resolve(o),delete t.requestMap[r]}))}))}return e.prototype.setApiKey=function(e){this.apiKey=e},e.prototype.getGeoserviceProxyUrl=function(e){return Me.fetchDomain().then((function(){var t=Me.get(),n=t.connectDomain,r=t._debug,o=t._localhost;return"https://"+n+"/geoservice?"+M(he(he({},e||{}),{origin:location.protocol+"//"+location.host,debug:r?1:null,localhost:o?1:null}))}))},e.prototype.prepareAnswer=function(e,t,n){var r=this,o=b();return this.bridge.sendMessage({handler:"VKSDKRequestToGeoservice:"+e,params:he(he({},t),{api_key:this.apiKey,wrapRequestInJSON:n,requestID:o})}),new Promise((function(e,t){r.requestMap[o]={resolve:e,reject:t}}))},e.prototype.getStaticMap=function(e){return this.prepareAnswer("staticmap/png/",e)},e.prototype.encodeCoords=function(e){return this.prepareAnswer("search",e)},e.prototype.decodeCoords=function(e){return this.prepareAnswer("overall",e)},e.prototype.getDirections=function(e){return this.prepareAnswer("directions",e,!0)},e.prototype.getISO=function(e){return this.prepareAnswer("iso",e,!0)},e}();(nt=e.DataPolicyEventsSDK||(e.DataPolicyEventsSDK={})).SHOW_DATA_POLICY="VKSDKOneTapAuthConnectDataPolicy",nt.HIDE_DATA_POLICY="VKSDKOneTapAuthDataPolicyClose",nt.DATA_POLICY_RESULT="VKSDKOneTapAuthDataPolicyResult",nt.SHOW_CAPTCHA="VKSDKOneTapAuthDataPolicyShowCaptcha",function(e){e.SHOW_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsShow",e.HIDE_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsHide",e.ACCEPT_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsAccept",e.DECLINE_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsDecline",e.POLICY_AGREEMENTS_ERROR="VKSDKOneTapAuthPolicyAgreementsError",e.SHOW_DATA_POLICY="VKSDKOneTapAuthPolicyAgreementsShowDataPolicy",e.GET_CAPTCHA="VKSDKGetCaptcha",e.CAPTCHA_SUCCESS="VKSDKGetCaptchaSuccess",e.CAPTCHA_FAIL="VKSDKGetCaptchaFail"}(rt||(rt={})),(ot=e.OneTapAuthEventsSDK||(e.OneTapAuthEventsSDK={})).PHONE_VALIDATION_NEEDED="VKSDKOneTapAuthPhoneValidationNeeded",ot.FULL_AUTH_NEEDED="VKSDKOneTapAuthFullAuthNeeded",ot.AUTH_DATA_LOADED="VKSDKOneTapAuthDataLoaded",ot.NOT_AUTHORIZED="VKSDKOneTapAuthNotAuthorized",ot.LOGIN_SUCCESS="VKSDKOneTapAuthLoginSuccess",ot.LOGIN_FAILED="VKSDKOneTapAuthLoginFailed",ot.RESIZE_FRAME="VKSDKOneTapResizeFrame",ot.SHOW_CAPTCHA="VKSDKOneTapShowCaptcha",ot.VALIDATE_CAPTCHA="VKSDKOneTapValidateCaptcha",ot.UPDATE_PARAMS="VKSDKUpdateParams",ot.AUTHORIZE_NEEDED="VKSDKButtonOneTapAuthAuthorizeNeeded",(it=e.FloatingOneTapAuthEventsSDK||(e.FloatingOneTapAuthEventsSDK={})).CLOSE_AUTH="VKSDKOneTapAuthClose",it.ADAPTIVITY_CHANGE="VKSDKFloatingOneTapAdaptivityChange",it.ADAPTIVITY_CHANGED="VKSDKFloatingOneTapAdaptivityChanged",it.UPDATE_PARAMS="VKSDKUpdateParams",(at=e.ButtonOneTapAuthEventsSDK||(e.ButtonOneTapAuthEventsSDK={})).SHOW_LOGIN="VKSDKButtonOneTapAuthShowLogin",at.SHOW_LOGIN_OPTIONS="VKSDKButtonOneTapAuthShowLoginOptions",at.SHOW_AGREEMENTS_DIALOG="VKSDKButtonOneTapAuthShowAgreementsDialog",at.START_AUTHORIZE="VKSDKButtonOneTapAuthStartAuthorize",at.UPDATE_PARAMS="VKSDKUpdateParams",function(e){e.WRONG_TOKEN="VKSDKBindAccountErrorWrongToken",e.ALREADY_BIND="VKSDKBindAccountErrorAlreadyBind"}(st||(st={}));var ut,lt=new De({url:[{rule:me,errorText:re("url")},{rule:ge,errorText:oe("url")}]}),pt=new De({uuid:[{rule:me,errorText:re("uuid")},{rule:ge,errorText:oe("uuid")}]}),dt=(new De({params:[{rule:ge,errorText:oe("params")}]}),new De({callback:[{rule:ge,errorText:oe("callback")}]})),ht=function(){function e(){}return e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e}(),ft=new De({params:[{rule:ge,errorText:oe("params")}]}),vt=function(){function t(){var t=this;this.config={},this.params={},this.loadingTask=new Ge,this.initTask=new Ge,this.cssText="",this.handleError=function(n){var r=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CUSTOM],e.SDKErrorCodes.CUSTOM,"",n));t.events.emit(e.CommonSDKEvents.ERROR,r)},this.events=fe(),this.handleBridgeMessage=this.handleBridgeMessage.bind(this),this.handleChangeSuperAppToken=this.handleChangeSuperAppToken.bind(this),this.close=this.close.bind(this),this.handleLogout=this.handleLogout.bind(this)}return t.prototype.preload=function(t){var n=this;return Me.fetchDomain().then((function(){return n.validateParams(t).then((function(){return n.updateParams(t),n.createIframe().then((function(){return n.initTask.start(),n.loadingTask.start(),n.timeoutTimer=setTimeout((function(){if(!n.initTask.finished){var t=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.LOADING_ERROR],e.SDKErrorCodes.LOADING_ERROR,te()));n.initTask.reject(t)}}),5e3),n.iframe.onload=function(){n.iframe.onload=null,n.loadingTask.resolve()},n.bridge=new He({iframe:n.iframe,origin:"https://"+Me.get().connectDomain}),n.bridge.onMessage(n.handleBridgeMessage),Me.events.on(de.SUPERAPP_TOKEN_CHANGE_V2,n.handleChangeSuperAppToken),Me.events.on(e.CommonSDKEvents.LOGOUT,n.close),n.getIframeContainer().appendChild(n.iframe),n.loadingTask.get()}))}))}))},t.prototype.open=function(e){var t=this;return this.validateParams(e).then((function(){return t.initTask.finished?(t.updateParams(e),Promise.resolve()):t.initTask.active||t.initTask.finished?(t.updateParams(e),t.initTask.get()):t.preload(e).then((function(){return t.initTask.get()}))}))},t.prototype.update=function(e,t){e&&this.updateParams(e),t&&this.updateConfig(t)},t.prototype.close=function(){this.iframe&&(this.iframe.onload=null,this.iframe.remove()),this.bridge&&this.bridge.destroy(),Me.events.off(de.SUPERAPP_TOKEN_CHANGE_V2,this.handleChangeSuperAppToken),Me.events.off(e.CommonSDKEvents.LOGOUT,this.close),delete this.iframe,delete this.bridge,this.loadingTask=new Ge,this.initTask=new Ge,this.events.emit(e.CommonSDKEvents.CLOSE)},t.prototype.sendMessage=function(e){var t=Pe.validate({message:e});!t.isValid()&&console.error(t.error()),this.bridge.sendMessage(e)},t.prototype.on=function(e,t){var n=Oe.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},t.prototype.off=function(e,t){var n=Oe.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},t.prototype.handleInit=function(){this.initTask.finished||(clearTimeout(this.timeoutTimer),this.initTask.resolve()),this.sendUpdateParamsMessage(),this.iframe.style.display="block"},t.prototype.handleRequestAuth=function(){Me._auth({version:2})},t.prototype.handleRequestSuperAppToken=function(e){Me._requestSuperAppToken(e,{version:2})},t.prototype.handleChangeSuperAppToken=function(t){this.bridge.sendMessage({handler:e.CommonSDKEvents.REQUEST_SUPERAPP_TOKEN+"Success",params:{result:t}})},t.prototype.handleBridgeMessage=function(t){switch(ht.log(t),t.handler){case F.INIT:this.handleInit();break;case e.CommonSDKEvents.REQUEST_SUPERAPP_TOKEN:this.handleRequestSuperAppToken(t.params);break;case e.CommonSDKEvents.AUTH_NEEDED:this.handleRequestAuth();break;case e.CommonSDKEvents.CLOSE:this.close();break;case e.CommonSDKEvents.ERROR:this.handleError(t.params);break;default:return}},t.prototype.handleLogout=function(){Me._logout()},t.prototype.handleAfterUpdateParams=function(){this.sendUpdateParamsMessage()},t.prototype.handleAfterUpdateConfig=function(){},t.prototype.handleAfterCreateIframe=function(){},t.prototype.validateParams=function(e){var t=ft.validate({params:e});return!t.isValid()&&console.error(t.error()),Promise.resolve(e)},t.prototype.createIframe=function(){var e=this;return this.getIframeUrl().then((function(t){return e.iframe=U(t,{cssText:e.cssText}),e.handleAfterCreateIframe(),Promise.resolve()}))},t.prototype.getIframeUrl=function(){return new Promise((function(e){return e("")}))},t.prototype.getIframeContainer=function(){return window.document.body},t.prototype.getIframeUrlParams=function(){var e=this;return Me.fetchDomain().then((function(){var t=Me.get(),n=t.superAppTokenV2,r=t.appId,o=t._debug,i=t._localhost;return Promise.resolve(M(he(he({},e.params),{host_app_id:r,superapp_token:n,origin:location.protocol+"//"+location.host,debug:o?1:null,localhost:i?1:null})))}))},t.prototype.updateConfig=function(e){this.config=H(this.config,e),this.handleAfterUpdateConfig()},t.prototype.updateParams=function(e){this.params=H(this.params,e||{}),this.handleAfterUpdateParams()},t.prototype.sendUpdateParamsMessage=function(){this.bridge&&this.initTask.finished&&this.bridge.sendMessage({params:this.params,handler:e.CommonSDKEvents.UPDATE_PARAMS})},t}();(ut=e.AuthorizeEvents||(e.AuthorizeEvents={})).CLOSE="VKSDKAuthorizeClose",ut.FAILED="VKSDKAuthorizeFailed",ut.SUCCESS="VKSDKAuthorizeSuccess";var mt=new De({scope:[{rule:ge,errorText:oe("scope")},{rule:me,errorText:re("scope")}]}),gt=function(t){function n(e){var n=t.call(this)||this;n.cssText="\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 9999;\n    border: none;\n    display: none;\n  ";var r=mt.validate({scope:e.scope});return!r.isValid()&&console.error(r.error()),n.updateConfig(e),n}return ce(n,t),n.prototype.handleBridgeMessage=function(n){switch(t.prototype.handleBridgeMessage.call(this,n),n.handler){case e.AuthorizeEvents.SUCCESS:n.params.code_verifier=this.codeVerifier,this.events.emit(e.AuthorizeEvents.SUCCESS,n);break;case e.AuthorizeEvents.FAILED:this.events.emit(e.AuthorizeEvents.FAILED,n);break;case e.AuthorizeEvents.CLOSE:this.close();break;default:return}},n.prototype.getIframeUrlParams=function(){var e=this;return Me.fetchDomain().then((function(){var t,n,r,o=Me.get(),i=o.appId,a=o._debug,s=o._localhost,c=b();return Promise.resolve(M(he(he({},e.params),{debug:a?1:null,localhost:s?1:null,client_id:i,code_challenge:e.codeChallenge,code_challenge_method:"s256",response_type:"code",state:c,origin:location.protocol+"//"+location.host,redirect_uri:null!==(t=e.config.redirect_uri)&&void 0!==t?t:location.protocol+"//"+location.host,device_id:null!==(n=e.config.device_id)&&void 0!==n?n:"",scope:null!==(r=e.config.scope)&&void 0!==r?r:""})))}))},n.prototype.open=function(e){return void 0===e&&(e={}),this.codeVerifier=Y(),this.codeChallenge=j(this.codeVerifier),t.prototype.open.call(this,e)},n.prototype.getIframeUrl=function(){var e=this;return Me.fetchDomain().then((function(){return e.getIframeUrlParams().then((function(e){var t=Me.get().connectDomain;return Promise.resolve("https://"+t+"/authorize?"+e)}))}))},n.prototype.handleAfterUpdateConfig=function(){this.updateZIndex()},n.prototype.handleAfterCreateIframe=function(){this.updateZIndex()},n.prototype.updateZIndex=function(){if(this.iframe){var e=this.config.zIndex;this.iframe.style.zIndex=""+e}},n}(vt),Et=function(){function t(){}var r;return t.on=function(e,t){var n=Oe.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},t.off=function(e,t){var n=Oe.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},r=t,t.flags=null,t.events=fe(),t.handleError=function(t){var n=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CUSTOM],e.SDKErrorCodes.CUSTOM,"",t));r.events.emit(e.CommonSDKEvents.ERROR,n)},t.silentAuth=function(){return Me.fetchDomain().then((function(){var t=Me.get(),n=t.loginDomain,r=t.appId,o=new Ge,i=b(),a="https://"+n+"/?act=connect&app_id="+r+"&response_type=silent_token&uuid="+i+"&v=1.60.0",s=new XMLHttpRequest;return s.open("GET",a,!0),s.responseType="json",s.withCredentials=!0,o.start(),s.onload=function(){var t,n=s.response,r=s.status>=200&&s.status<300;if(n&&(null===(t=n.error)||void 0===t?void 0:t.error_code)===e.SDKErrorCodes.CAPTCHA_ERROR){var c=n.error,u=c.captcha_sid,l=c.captcha_img;new $e(i,{captcha_sid:u,captcha_img:l}).show().then((function(e){var t=a+"&captcha_key="+e.captcha_key+"&captcha_sid="+e.captcha_sid;s.open("GET",t,!0),s.send()}))}else n&&r?o.resolve({provider:"vk",payload:s.response}):o.reject()},s.onerror=function(){o.reject()},s.send(),o.get()}))},t.oneTapAuth=function(e,n){if(console.warn("Connect.oneTapAuth method is deprecated. Use Connect.floatingOneTapAuth and Connect.buttonOneTapAuth methods."),!["floating","button"].includes(e))return null;switch(e){case"button":return t.buttonOneTapAuth(n);case"floating":return t.floatingOneTapAuth(n);default:return null}},t.floatingOneTapAuth=function(n){var o=dt.validate({callback:n.callback});!o.isValid()&&console.error(o.error());var i=function(){var e,t=window.innerWidth,n=t<=768;return{destroy:function(){return window.removeEventListener("resize",e)},isAdaptive:function(){return n},observe:function(r){e=function(){var e=window.innerWidth;t>768&&e<=768?r(n=!0):t<=768&&e>768&&r(n=!1),t=e},window.addEventListener("resize",e)}}}(),a=function(e,t){var n,r,o,i={},a=e?"314px":"334px",s=e?"\n      display: none;\n      position: fixed;\n      bottom: 0;\n      right: 50%;\n      transform: translate(50%, 0);\n      max-width: 468px;\n      width: 100%;\n      height: "+a+";\n    ":"\n        display: none;\n        position: fixed;\n        top: 0;\n        right: 0;\n        max-width: 400px;\n        width: 100%;\n        height: "+a+";\n      ";return(null===(n=null==t?void 0:t.styles)||void 0===n?void 0:n.zIndex)&&isFinite(null===(r=null==t?void 0:t.styles)||void 0===r?void 0:r.zIndex)&&(s+="z-index: "+(null===(o=null==t?void 0:t.styles)||void 0===o?void 0:o.zIndex)+";"),t&&(i.skip_success=G(t.skipSuccess,0),void 0!==t.scheme&&["bright_light","space_gray"].includes(t.scheme)&&(i.scheme=t.scheme)),{pageUrl:"floating_one_tap_auth",pageUrlParams:he({adaptive:e?1:0},i),frameStyles:s,scheme:(null==t?void 0:t.scheme)||"bright_light"}}(i.isAdaptive(),n.options),s=Y(),c=j(s);if(!a)throw new Error("options were not set");var u,l,p,d=b(),h=he({origin:location.protocol+"//"+location.host,uuid:d},a.pageUrlParams),f=a.pageUrl,v=new Ge,m=function(){l&&l.sendMessage({handler:e.OneTapAuthEventsSDK.RESIZE_FRAME,params:{uuid:d}})},g=function(){u&&(u.remove(),u=null),window.removeEventListener("resize",m),i&&i.destroy(),l&&l.destroy()};p=new Promise((function(e){v.start(),v.get().then((function(t){e(t)}))}));var E=function(o){var i=o.params.uuid===d;if(o.params.code_verifier=s,i)switch(o.handler){case e.CommonSDKEvents.ERROR:r.handleError(o.params);break;case e.OneTapAuthEventsSDK.NOT_AUTHORIZED:n.callback({type:o.handler,payload:{uuid:d,error:"not_authorized"}}),g(),v.resolve(o.handler);break;case e.OneTapAuthEventsSDK.RESIZE_FRAME:u.style.height=o.params.height+"px";break;case e.FloatingOneTapAuthEventsSDK.CLOSE_AUTH:n.callback({type:o.handler,payload:{uuid:d}}),g();break;case e.FloatingOneTapAuthEventsSDK.ADAPTIVITY_CHANGED:u.style.display="block";break;case e.OneTapAuthEventsSDK.AUTH_DATA_LOADED:u.style.display="block",v.resolve(o.handler);default:t.handleOneTapEvents(o,l,n)}};return u=U("",{cssText:null==a?void 0:a.frameStyles}),document.body.appendChild(u),Me.fetchDomain().then((function(){return We(he(he({},h),{code_challenge:c,code_challenge_method:"s256"}),f).then((function(t){u.src=t,(l=new He({iframe:u,origin:"https://"+Me.get().connectDomain})).onMessage(E),i.observe((function(t){l.sendMessage({handler:e.FloatingOneTapAuthEventsSDK.ADAPTIVITY_CHANGE,params:{uuid:d,is_adaptive:t}}),t?(u.style.maxWidth="468px",u.style.top="auto",u.style.bottom="0",u.style.right="50%",u.style.transform="translate(50%, 0)"):(u.style.maxWidth="400px",u.style.top="0",u.style.bottom="auto",u.style.right="0",u.style.transform="none"),u.style.display="none"})),window.addEventListener("resize",m)}))})),{getFrame:function(){return u},destroy:g,authReadyPromise:p,update:function(t){a=H(a||{},t),l&&a&&l.sendMessage({handler:e.FloatingOneTapAuthEventsSDK.UPDATE_PARAMS,params:a})}}},t.buttonOneTapAuth=function(n){var r=dt.validate({callback:n.callback});!r.isValid()&&console.error(r.error());var i=function(e){var t,n,r,i,a,s,c={},u=44,l=56;return e&&(c.display=e.displayMode&&Ze.includes(e.displayMode)?e.displayMode:je.Default,c.button_skin=e.buttonSkin&&Qe.includes(e.buttonSkin)?e.buttonSkin:qe.Primary,c.show_agreements=G(e.showAgreements,0),c.show_alternative_login=G(e.showAlternativeLogin,0),void 0!==e.scheme&&["bright_light","space_gray"].includes(e.scheme)&&(c.scheme=e.scheme),void 0!==(null===(t=e.buttonStyles)||void 0===t?void 0:t.height)&&(u=Number(null===(n=e.buttonStyles)||void 0===n?void 0:n.height),l=Number(null===(r=e.buttonStyles)||void 0===r?void 0:r.height)+12,c.style_height=null===(i=e.buttonStyles)||void 0===i?void 0:i.height),void 0!==(null===(a=e.buttonStyles)||void 0===a?void 0:a.borderRadius)&&(c.style_border_radius=null===(s=e.buttonStyles)||void 0===s?void 0:s.borderRadius),void 0!==e.langId&&(c.lang_id=Ye.includes(e.langId)?e.langId:o),u+=c.show_alternative_login?l:0,u+=c.show_agreements?80:0),{pageUrl:"button_one_tap_auth",pageUrlParams:c,frameStyles:"\n        height: "+u+"px;\n      ",scheme:(null==e?void 0:e.scheme)||"bright_light"}}(n.options),a=Y(),s=j(a);if(!i)throw new Error("options were not set");var c,u,l,p=b(),d=he({origin:location.protocol+"//"+location.host,uuid:p},i.pageUrlParams),h=i.pageUrl,f=new Ge;l=new Promise((function(e){f.start(),f.get().then((function(t){e(t)}))}));var v=function(){u&&u.sendMessage({handler:e.OneTapAuthEventsSDK.RESIZE_FRAME,params:{uuid:p}})},m=function(r){var o=r.params.uuid===p;if(r.params.code_verifier=a,o)switch(r.handler){case e.OneTapAuthEventsSDK.RESIZE_FRAME:c.style.height=r.params.height+"px";break;case e.OneTapAuthEventsSDK.NOT_AUTHORIZED:f.resolve(r.handler);break;case e.ButtonOneTapAuthEventsSDK.SHOW_LOGIN:case e.ButtonOneTapAuthEventsSDK.SHOW_LOGIN_OPTIONS:n.callback({type:r.handler,payload:{uuid:p}});break;case e.ButtonOneTapAuthEventsSDK.SHOW_AGREEMENTS_DIALOG:t.userPolicyAgreements(p,null==i?void 0:i.scheme).show().then((function(t){t&&t.accepted&&u.sendMessage({handler:e.ButtonOneTapAuthEventsSDK.START_AUTHORIZE,params:{uuid:p}})})).catch((function(){u.sendMessage({handler:rt.DECLINE_POLICY_AGREEMENTS,params:{uuid:p}})}));break;case e.OneTapAuthEventsSDK.AUTH_DATA_LOADED:f.resolve(r.handler);default:t.handleOneTapEvents(r,u,n)}};c=U("",{cssText:null==i?void 0:i.frameStyles});var g=n.container;return g&&g.appendChild(c),Me.fetchDomain().then((function(){return We(he(he({},d),{code_challenge:s,code_challenge_method:"s256"}),h).then((function(e){c.src=e,(u=new He({iframe:c,origin:"https://"+Me.get().connectDomain})).onMessage(m),window.addEventListener("resize",v)}))})).catch(console.error),{getFrame:function(){return c},destroy:function(){c&&(c.remove(),c=null),window.removeEventListener("resize",v),u&&u.destroy()},authReadyPromise:l,update:function(t){i=H(i||{},t),u&&i&&u.sendMessage({handler:e.ButtonOneTapAuthEventsSDK.UPDATE_PARAMS,params:i})}}},t.handleOneTapEvents=function(n,o,i){var a,s,c=n.params.uuid;switch(n.handler){case e.CommonSDKEvents.ERROR:r.handleError(n.params);break;case e.OneTapAuthEventsSDK.AUTH_DATA_LOADED:o.sendMessage({handler:e.OneTapAuthEventsSDK.RESIZE_FRAME,params:{uuid:c}});break;case e.OneTapAuthEventsSDK.LOGIN_SUCCESS:i.callback({type:n.handler,provider:"vk",payload:n.params});break;case e.OneTapAuthEventsSDK.SHOW_CAPTCHA:var u=new $e(c,{captcha_sid:n.params.captcha_sid,captcha_img:n.params.captcha_img},null===(a=i.options)||void 0===a?void 0:a.scheme);u.show().then((function(t){o.sendMessage({handler:e.AuthCaptchaEventsSDK.CAPTCHA_SUCCESS,params:he({uuid:c},t)})})).catch((function(){o.sendMessage({handler:e.AuthCaptchaEventsSDK.CAPTCHA_FAIL,params:{uuid:c}}),u.destroy()}));break;case e.DataPolicyEventsSDK.SHOW_DATA_POLICY:t.userDataPolicy(c,null===(s=i.options)||void 0===s?void 0:s.scheme).show().then((function(){i.callback({type:e.DataPolicyEventsSDK.DATA_POLICY_RESULT,payload:{uuid:c,policyAccepted:!0}})})).catch((function(){i.callback({type:e.DataPolicyEventsSDK.DATA_POLICY_RESULT,payload:{uuid:c,policyAccepted:!1}})}));break;case e.OneTapAuthEventsSDK.AUTHORIZE_NEEDED:var l={scope:n.params.scope,device_id:n.params.device_id},p=new gt(l);p.open({}).catch((function(e){console.error(e),p.close()}));var d=function t(n){var r=n.params,o=r.uuid,a=r.code,s=r.code_verifier,c=o&&a?e.OneTapAuthEventsSDK.LOGIN_SUCCESS:e.OneTapAuthEventsSDK.LOGIN_FAILED;i.callback({type:c,provider:"vk",payload:{code:a,state:o,code_verifier:s}}),p.close(),p.off(e.AuthorizeEvents.SUCCESS,t),p.off(e.AuthorizeEvents.FAILED,t)};p.on(e.AuthorizeEvents.SUCCESS,d),p.on(e.AuthorizeEvents.FAILED,d);break;case e.OneTapAuthEventsSDK.FULL_AUTH_NEEDED:case e.OneTapAuthEventsSDK.PHONE_VALIDATION_NEEDED:i.callback({type:n.handler,payload:{uuid:c}})}},t.userDataPolicy=function(t,n){var o,i=pt.validate({uuid:t});!i.isValid()&&console.error(i.error());var a,s=window.innerHeight,c=function(){o&&(o.style.display="none")},u=new Ge,l=function(){o&&o.remove(),a&&a.destroy()};o=U("",{properties:{height:s+"px"},cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100vh;\n      min-height: 100vh;\n      border: none;\n      z-index: 99999;\n    "}),document.body.appendChild(o);var p=function(i){switch(i.handler){case e.CommonSDKEvents.ERROR:r.handleError(i.params);break;case e.DataPolicyEventsSDK.HIDE_DATA_POLICY:c(),u.resolve(void 0),l();break;case e.DataPolicyEventsSDK.SHOW_CAPTCHA:var s=new $e(t,{captcha_sid:i.params.captcha_sid,captcha_img:i.params.captcha_img},n);s.show().then((function(n){a.sendMessage({handler:e.AuthCaptchaEventsSDK.CAPTCHA_SUCCESS,params:he({uuid:t},n)}),o.style.display="block"})).catch((function(){a.sendMessage({handler:e.AuthCaptchaEventsSDK.CAPTCHA_FAIL,params:{uuid:t}}),s.destroy()})),c();break;default:c(),u.reject(),l()}};return Me.fetchDomain().then((function(){We({origin:location.protocol+"//"+location.host,uuid:t,scheme:n||"bright_light"},"user_data_policy").then((function(e){o.src=e})),(a=new He({iframe:o,origin:"https://"+Me.get().connectDomain})).onMessage(p)})),{show:function(){return o.style.display="block",new Promise((function(e){u.start(),u.get().then((function(t){e(t)}))}))},hide:c,destroy:l}},t.userPolicyAgreements=function(n,o){var i,a,s,c,u=new Ge;s="",c=window.innerHeight,i=U(s,{properties:{height:c+"px"},cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+c+"px;\n      min-height: "+c+"px;\n      border: none;\n      z-index: 99999;\n    "}),document.body.appendChild(i);var l=function(){i&&(i.remove(),i=null),a&&a.destroy()},p=function(){i&&(i.style.display="none")},d=function(s){switch(s.handler){case e.CommonSDKEvents.ERROR:r.handleError(s.params);break;case rt.ACCEPT_POLICY_AGREEMENTS:p(),u.resolve({accepted:!0}),l();break;case rt.DECLINE_POLICY_AGREEMENTS:p(),u.resolve({accepted:!1}),l();break;case rt.GET_CAPTCHA:var c=new $e(n,{captcha_sid:s.params.captcha_sid,captcha_img:s.params.captcha_img},o);c.show().then((function(e){a.sendMessage({handler:rt.CAPTCHA_SUCCESS,params:he({uuid:n},e)}),i.style.display="block"})).catch((function(){a.sendMessage({handler:rt.CAPTCHA_FAIL,params:{uuid:n}}),c.destroy()})),p();break;case rt.SHOW_DATA_POLICY:p();var d=function(){i.style.display="block"};t.userDataPolicy(n,o).show().then(d).catch(d);break;case rt.POLICY_AGREEMENTS_ERROR:case rt.HIDE_POLICY_AGREEMENTS:default:u.reject(),l()}};return Me.fetchDomain().then((function(){We({origin:location.protocol+"//"+location.host,uuid:n,scheme:o||"bright_light"},"user_policy_agreements").then((function(e){i.src=e,(a=new He({iframe:i,origin:"https://"+Me.get().connectDomain})).onMessage(d)}))})),{show:function(){return i.style.display="block",new Promise((function(e){u.start(),u.get().then((function(t){e(t)}))}))},hide:p,destroy:l}},t.userVisibleAuth=function(r){return Me.fetchDomain().then((function(){var o=b(),i=Me.get(),a=he(he({origin:location.protocol+"//"+location.host,uuid:o,debug:i._debug?1:null,localhost:i._localhost?1:null},B(r,["screen","source"])),{scheme:null==r?void 0:r.scheme}),s=ze(null==r?void 0:r.action);s&&(a.action=s);var c=Fe(null==r?void 0:r.entry);return c&&(a.initial_stats_info=c),We(a).then((function(r){t.flags&&(r=r+"#"+M(t.flags));var i=screen.height/2-280,a=screen.width/2-410,s=window.open(r,"_blank","top="+i+",left="+a+",width=820,height=560,location");if(!s){var c=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_WINDOW_NOT_OPENED],e.SDKErrorCodes.CONNECT_WINDOW_NOT_OPENED,J()));return Promise.reject(c)}return new Promise((function(t,r){var i=setInterval((function(){if(!s||s.closed){window.removeEventListener("message",a),clearInterval(i);var t=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_WINDOW_CLOSED],e.SDKErrorCodes.CONNECT_WINDOW_CLOSED,Q()));r(t)}}),1e3);function a(c){if(c.source===s&&s)if(window.removeEventListener("message",a),clearInterval(i),function(e){for(var t=0;t<n.length;t++){var r=n[t];if(e.slice(e.length-r.length)===r)return!0}return!1}(c.origin))if(c.data.action==="vk_connect_response"+o){var u=c.data.payload;if(s.close(),u.error){p=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_CLIENT_SDK_ERROR],e.SDKErrorCodes.CONNECT_CLIENT_SDK_ERROR,ee(u.error)));r(p)}else t({provider:"vk",payload:u})}else if(c.data.action==="oauth_callback"+o)t({provider:c.data.payload.name}),s.close();else if(c.data.action==="skip_callback"+o){var l=c.data.payload.redirectURL;l&&(window.location.href=l),s.close()}else if(c.data.action==="bind_ok_account"+o)t(c.data.payload),s.close();else{s.close();p=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_UNKNOWN_SDK_MESSAGE],e.SDKErrorCodes.CONNECT_UNKNOWN_SDK_MESSAGE,$(JSON.stringify(c.data))));r(p)}else{s.close();var p=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_DOMAIN_NOT_ALLOWED],e.SDKErrorCodes.CONNECT_DOMAIN_NOT_ALLOWED,X(c.origin)));r(p)}}window.addEventListener("message",a)}))}))}))},t.redirectAuth=function(e){var t=lt.validate(e);!t.isValid()&&console.error(t.error());var n=e.code_verifier?{code_challenge:j(e.code_verifier),code_challenge_method:"s256"}:{},r=b(),o=he(he(he({redirect_uri:e.url,uuid:r},B(e,["screen","source"])),{scheme:null==e?void 0:e.scheme}),n),i=ze(null==e?void 0:e.action);i&&(o.action=i);var a=Fe(null==e?void 0:e.entry);a&&(o.initial_stats_info=a),(null==e?void 0:e.state)&&(o.redirect_state=e.state),We(o).then((function(e){location.assign(e)}))},t.logout=function(){return Me.fetchDomain().then((function(){var t=Me.get(),n=t.connectDomain,r=t.appId,o=t.superAppTokenV2;if(!o)return Promise.reject(Z("superappToken","SuperappToken is undefined"));var i=M({origin:location.protocol+"//"+location.host,host_app_id:r,superapp_token:o}),a=fetch("https://"+n+"/logout?"+i,{credentials:"include"});return Me.events.emit(e.CommonSDKEvents.LOGOUT),Me.setSuperAppToken(""),Me.setSuperAppToken("",{version:2}),a}))},t}(),_t={OneTapAuthEventsSDK:e.OneTapAuthEventsSDK,FloatingOneTapAuthEventsSDK:e.FloatingOneTapAuthEventsSDK,ButtonOneTapAuthEventsSDK:e.ButtonOneTapAuthEventsSDK,DataPolicyEventsSDK:e.DataPolicyEventsSDK},At=["open_account"];var yt,St=function(){function t(){}return t.open=function(t){var n=Ce.validate({token:t.action.token});return!n.isValid()&&console.error(n.error()),Me.fetchDomain().then((function(){var n,r=b(),o=Me.get(),i=he({origin:location.protocol+"//"+location.host,uuid:r,debug:G(o._debug,0),localhost:G(o._localhost,0)},B(t,["screen","source"])),a=(n=null==t?void 0:t.action)&&At.includes(n.name)?btoa(JSON.stringify(n)):"";return a&&(i.action=a),function(e){return Me.fetchDomain().then((function(){var t=Me.get(),n=t.appId,r=t.connectDomain,o=t.appSettings,i=t._debug,a=t._localhost,s=he({app_id:n,response_type:"silent_token",v:"1.60.0",debug:i?1:null,localhost:a?1:null},e);o&&L(o)&&(s.app_settings=V(o));var c=M(s);return Promise.resolve("https://"+r+"/open_account?"+c)}))}(i).then((function(t){if(!window.open(t,"_blank")){var n=ye(_e(e.SDKErrorCodes[e.SDKErrorCodes.CONNECT_WINDOW_NOT_OPENED],e.SDKErrorCodes.CONNECT_WINDOW_NOT_OPENED,J()));return Promise.reject(n)}return Promise.resolve()}))}))},t}();!function(e){e.INTERNAL_RESIZE="VKSDKMessengerInternalResize",e.INTERNAL_LOGOUT="VKSDKMessengerInternalLogout"}(yt||(yt={})),(e.MessengerEvents||(e.MessengerEvents={})).CLOSE_CHAT="VKSDKMessengerCloseChat";var Tt,Dt=new De({config:[{rule:ge,errorText:oe("config")}]}),Ct={styles:{bottom:"0",right:"0",zIndex:99999}},Ot=function(t){function n(e){var n=t.call(this)||this;n.config=Ct,n.cssText="\n    border: none;\n    display: none;\n    position: fixed;\n    color-scheme: auto;\n  ",n.updateStyles=function(){if(n.iframe){var e=n.config.styles,t=isFinite(e.zIndex)?e.zIndex:999999;n.iframe.style.zIndex=""+t,n.iframe.style.bottom=e.bottom,n.iframe.style.right=e.right}};var r=Dt.validate({config:e});return!r.isValid()&&console.error(r.error()),n.updateConfig(e),n}return ce(n,t),n.prototype.handleBridgeMessage=function(n){var r=this;switch(t.prototype.handleBridgeMessage.call(this,n),n.handler){case e.CommonSDKEvents.GET_CAPTCHA:var o=n.params.uuid,i=new $e(o,{captcha_sid:n.params.captcha_sid,captcha_img:n.params.captcha_img});i.show().then((function(t){r.bridge.sendMessage({handler:e.CommonSDKEvents.GET_CAPTCHA+"Success",params:he({uuid:o},t)})})).catch((function(){r.bridge.sendMessage({handler:e.CommonSDKEvents.GET_CAPTCHA+"Fail",params:{uuid:o}}),i.destroy()}));break;case yt.INTERNAL_RESIZE:this.handleInternalIframeResize(n);break;case yt.INTERNAL_LOGOUT:this.handleLogout();break;case e.MessengerEvents.CLOSE_CHAT:this.events.emit(e.MessengerEvents.CLOSE_CHAT,n.params);break;default:return}},n.prototype.handleInternalIframeResize=function(e){var t=e.params;this.iframe.width=t.width+"px",this.iframe.height=t.height+"px"},n.prototype.handleAfterUpdateConfig=function(){this.updateStyles()},n.prototype.handleAfterCreateIframe=function(){this.updateStyles()},n.prototype.validateParams=function(e){return e.peer_id>=0?Promise.reject(Z("peer_id","Peer id can`t be positive")):Promise.resolve(e)},n.prototype.getIframeUrl=function(){var e=this;return Me.fetchDomain().then((function(){return e.getIframeUrlParams().then((function(e){var t=Me.get().connectDomain;return Promise.resolve("https://"+t+"/messenger?"+e)}))}))},n}(vt);(Tt=e.AuthQREvents||(e.AuthQREvents={})).SCANNED="VKSDKQRScaned",Tt.CLICKED="VKSDKQRClicked";var wt,Pt=new De({container:[{rule:ge,errorText:oe("container")}]}),bt=function(t){function n(e){var n=t.call(this)||this;n.getIframeContainer=function(){return n.config.container?n.config.container:window.document.body};var r=Pt.validate(e);return!r.isValid()&&console.error(r.error()),(null==e?void 0:e.langId)&&!Ye.includes(null==e?void 0:e.langId)&&console.error(Z("lang_id","This lang id is not allowed")),n.updateConfig(e),n}return ce(n,t),n.prototype.getIframeUrl=function(){return this.getIframeUrlParams().then((function(e){var t=Me.get().connectDomain;return Promise.resolve("https://"+t+"/qr_auth?"+e)}))},n.prototype.getIframeUrlParams=function(){var e=this;return Me.fetchDomain().then((function(){var t,n=Me.get(),r=n.appId,o=n._debug,i=n._localhost;return Promise.resolve(M({scheme:(null===(t=e.params)||void 0===t?void 0:t.scheme)||"bright_light",app_id:r,origin:location.protocol+"//"+location.host,lang_id:e.config.langId||null,initial_stats_info:Fe(e.config.entry)||null,debug:o?1:null,localhost:i?1:null}))}))},n.prototype.handleBridgeMessage=function(n){var r=this;switch(t.prototype.handleBridgeMessage.call(this,n),n.handler){case e.AuthQREvents.CLICKED:this.events.emit(e.AuthQREvents.CLICKED);break;case e.AuthQREvents.SCANNED:this.events.emit(e.AuthQREvents.SCANNED,n.params.token);break;case e.CommonSDKEvents.GET_CAPTCHA:var o=n.params.uuid,i=new $e(o,{captcha_sid:n.params.captcha_sid,captcha_img:n.params.captcha_img});i.show().then((function(t){r.bridge.sendMessage({handler:e.CommonSDKEvents.GET_CAPTCHA+"Success",params:he({uuid:o},t)})})).catch((function(){r.bridge.sendMessage({handler:e.CommonSDKEvents.GET_CAPTCHA+"Fail",params:{uuid:o}}),i.destroy()}));break;default:return}},n}(vt);(wt=e.UserEvents||(e.UserEvents={})).CONTENT_IN_HEIGHT="VKSDKUserContentInHeight",wt.VALIDATION_PHONE_CLOSE="VKSDKUserValidationPhoneClose";var Kt,It=new De({container:[{rule:ge,errorText:oe("container")}]}),Nt=new De({canSkip:[{rule:ge,errorText:oe("canSkip")}],origin:[{rule:ge,errorText:oe("origin")}]}),kt=function(t){function n(e){var n=t.call(this)||this;n.getIframeContainer=function(){return n.config.container?n.config.container:window.document.body};var r=It.validate(e);return!r.isValid()&&console.error(r.error()),n.updateConfig(e),n}return ce(n,t),n.prototype.getIframeUrl=function(){var e=he(he({redirect_uri:this.params.url,uuid:b()},B(this.params,["screen","source"])),{scheme:this.params.scheme}),t=ze(this.params.action);t&&(e.action=t);var n=Fe(this.params.entry);return n&&(e.initial_stats_info=n),this.params.state&&(e.redirect_state=this.params.state),We(e)},n.prototype.handleBridgeMessage=function(n){switch(t.prototype.handleBridgeMessage.call(this,n),n.handler){case e.UserEvents.CONTENT_IN_HEIGHT:this.events.emit(e.UserEvents.CONTENT_IN_HEIGHT,n.params);break;case e.UserEvents.VALIDATION_PHONE_CLOSE:this.events.emit(e.UserEvents.VALIDATION_PHONE_CLOSE,n.params);break;default:return}},n.prototype.validatePhone=function(e){var t=Nt.validate(e);!t.isValid()&&console.error(t.error());var n={name:"auth_validation_phone",params:{status:e.canSkip?"1":"0"}};e.sid&&(n.params.sid=e.sid),this.open({url:e.origin,scheme:e.scheme,action:n})},n}(vt);(Kt=e.VerificationProfileEvents||(e.VerificationProfileEvents={})).SUCCESS="VKSDKVerificationProfileSuccess",Kt.CLOSE="VKSDKVerificationProfileClose";var Rt=new De({config:[{rule:ge,errorText:oe("config")}],provider:[{rule:me,errorText:re("provider")},{rule:ge,errorText:oe("provider")}]}),Mt=function(t){function n(e){var n=t.call(this)||this;n.cssText="\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 9999;\n    border: none;\n    display: none;\n  ";var r=Rt.validate({config:e,provider:e.provider});return!r.isValid()&&console.error(r.error()),n.updateConfig(e),n}return ce(n,t),n.prototype.handleBridgeMessage=function(n){switch(t.prototype.handleBridgeMessage.call(this,n),n.handler){case e.VerificationProfileEvents.SUCCESS:this.events.emit(e.VerificationProfileEvents.SUCCESS);break;case e.VerificationProfileEvents.CLOSE:this.close();break;default:return}},n.prototype.handleAfterUpdateConfig=function(){this.updateZIndex()},n.prototype.handleAfterCreateIframe=function(){this.updateZIndex()},n.prototype.getIframeUrlParams=function(){var e=this;return Me.fetchDomain().then((function(){var t=Me.get(),n=t.superAppTokenV2,r=t.appId,o=t._debug,i=t._localhost;return Promise.resolve(M(he(he({},e.params),{app:r,superapp_token:n,origin:location.protocol+"//"+location.host,debug:o?1:null,localhost:i?1:null,provider:e.config.provider})))}))},n.prototype.getIframeUrl=function(){var e=this;return Me.fetchDomain().then((function(){return e.getIframeUrlParams().then((function(e){var t=Me.get().connectDomain;return Promise.resolve("https://"+t+"/verification_profile?"+e)}))}))},n.prototype.updateZIndex=function(){if(this.iframe){var e=this.config.zIndex;this.iframe.style.zIndex=""+e}},n}(vt);e.Account=St,e.AuthQR=bt,e.Authorize=gt,e.BodyOverflowManager=q,e.Config=Me,e.Connect=Et,e.ConnectEvents=_t,e.GeoService=ct,e.Messenger=Ot,e.MiniApp=et,e.MiniAppService=tt,e.User=kt,e.VerificationProfile=Mt,Object.defineProperty(e,"__esModule",{value:!0})}));
