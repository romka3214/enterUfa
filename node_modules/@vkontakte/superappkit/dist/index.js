function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t=["vk.com","vk.ru"],n=["agreements","promo","vkc_behavior","vkc_auth_action","vkc_brand","vkc_display_mode","service_groups","external_device_id"],r=0,o=1,i=3,a=4,s=6,c=15,u=16,l=82,p=!("undefined"==typeof window||!window.document||!window.document.createElement),d=p&&!!window.addEventListener,h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function m(e,t){return e(t={exports:{}},t.exports),t.exports}var v=f(m((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}))),g=function(){};if(d)try{var _=Object.defineProperty({},"passive",{get:function(){!0}});window.addEventListener("test",g,_),window.removeEventListener("test",g,_)}catch(e){}!function(){if(!p)return!1;var e=!1;try{document.createElement("div").scrollTo({top:0,get behavior(){return e=!0,"smooth"}})}catch(e){}}();var y=m((function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.default=e.exports,e.exports.__esModule=!0}));f(y);var A=m((function(e){e.exports=function(e){if(Array.isArray(e))return y(e)},e.exports.default=e.exports,e.exports.__esModule=!0}));f(A);var E=m((function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0}));f(E);var T=m((function(e){e.exports=function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0}));f(T);var S=m((function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}));f(S),f(m((function(e){e.exports=function(e){return A(e)||E(e)||T(e)||S()},e.exports.default=e.exports,e.exports.__esModule=!0})));var O=f(m((function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.default=e.exports,e.exports.__esModule=!0})));function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b={parse:function(e){if("string"!=typeof e)return{};if(!(e=e.trim().replace(/^[?#&]/,"")))return{};var t=/\?(.+)$/gi.exec(e);return(t?t[1]:e).split("&").reduce((function(e,t){var n=t.split("=");return n[1]&&(e[n[0]]=decodeURIComponent(n[1])),e}),{})},stringify:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==v(e)||null===e)return"";t=C({encode:!0},t);var n=function(e){return t.encode?encodeURIComponent(e):String(e)};return Object.keys(e).reduce((function(r,o){var i=e[o];return void 0===i?r:null===i?(t.skipNull||r.push([n(o),""].join("=")),r):Array.isArray(i)?(i.map((function(e){r.push("".concat(n(o),"[]=").concat(n(e)))})).join(),r):(r.push([n(o),n(i)].join("=")),r)}),[]).join("&")}};f(m((function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0}))),f(m((function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0})));var P,D="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW",I=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21,t="",n=e;n--;)t+=D[64*Math.random()|0];return t},N=(P=Object.freeze({__proto__:null,default:{}}))&&P.default||P,k=m((function(e,t){var n;e.exports=(n=n||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==h&&h.crypto&&(n=h.crypto),!n)try{n=N}catch(e){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},a=i.lib={},s=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,o=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var a=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=a<<24-(r+i)%4*8}else for(var s=0;s<o;s+=4)t[r+s>>>2]=n[s>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new c.init(t,e)}}),u=i.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},p=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],o=0;o<n;o++){var i=t[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},d=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},f=a.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,o=r.words,i=r.sigBytes,a=this.blockSize,s=i/(4*a),u=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,l=e.min(4*u,i);if(u){for(var p=0;p<u;p+=a)this._doProcessBlock(o,p);n=o.splice(0,u),r.sigBytes-=l}return new c.init(n,l)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),m=(a.Hasher=f.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math),n)})),R=m((function(e,t){var n;e.exports=(n=k,function(e){var t=n,r=t.lib,o=r.WordArray,i=r.Hasher,a=t.algo,s=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,o=0;o<64;)t(r)&&(o<8&&(s[o]=n(e.pow(r,.5))),c[o]=n(e.pow(r,1/3)),o++),r++}();var u=[],l=a.SHA256=i.extend({_doReset:function(){this._hash=new o.init(s.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],a=n[3],s=n[4],l=n[5],p=n[6],d=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var f=u[h-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,v=u[h-2],g=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;u[h]=m+u[h-7]+g+u[h-16]}var _=r&o^r&i^o&i,y=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),A=d+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&l^~s&p)+c[h]+u[h];d=p,p=l,l=s,s=a+A|0,a=i,i=o,o=r,r=A+(y+_)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+a|0,n[4]=n[4]+s|0,n[5]=n[5]+l|0,n[6]=n[6]+p|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,o=8*t.sigBytes;return n[o>>>5]|=128<<24-o%32,n[14+(o+64>>>9<<4)]=e.floor(r/4294967296),n[15+(o+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(l),t.HmacSHA256=i._createHmacHelper(l)}(Math),n.SHA256)})),x=m((function(e,t){var n,r,o;e.exports=(r=(n=o=k).lib.WordArray,n.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var o=[],i=0;i<n;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<n;s++)o.push(r.charAt(a>>>6*(3-s)&63));var c=r.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var a=n.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,n){for(var o=[],i=0,a=0;a<t;a++)if(a%4){var s=n[e.charCodeAt(a-1)]<<a%4*2,c=n[e.charCodeAt(a)]>>>6-a%4*2,u=s|c;o[i>>>2]|=u<<24-i%4*8,i++}return r.create(o,i)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},o.enc.Base64)}));function K(e){return b.stringify(e,{skipNull:!0})}function M(e){return Object.keys(e).filter((function(e){return n.includes(e)}))}function L(e){var t;return Boolean(null===(t=M(e))||void 0===t?void 0:t.length)}function V(e){var t=function(e){return M(e).reduce((function(t,n){return t[n]=e[n],t}),{})}(e);return btoa(JSON.stringify(t))}function U(e,t){var n,r,o=document.createElement("iframe");for(var i in e&&(o.src=e),o.style.cssText=null!==(n=null==t?void 0:t.cssText)&&void 0!==n?n:"",o.width="100%",o.height="100%",o.style.border="none",null==t?void 0:t.properties)t&&t.properties.hasOwnProperty(i)&&(o[i]=null!==(r=t.properties[i])&&void 0!==r?r:"");return o}function H(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(t){return t&&"object"===e(t)};return t.reduce((function(e,t){return Object.keys(t).forEach((function(n){var o=e[n],i=t[n];Array.isArray(o)&&Array.isArray(i)?e[n]=o.concat.apply(o,i):r(o)&&r(i)?e[n]=H(o,i):e[n]=i})),e}),{})}function G(e,t){return void 0===e?t:"number"!=typeof e?e?1:0:e}function B(t,n){return t&&"object"===e(t)?Object.keys(t).reduce((function(e,r){return n.includes(r)?(e[r]=t[r],e):e}),{}):t}var W,F,z,j=function(e){var t=R(e);return x.stringify(t).replace(/=*$/g,"").replace(/\+/g,"-").replace(/\//g,"_")},Y=function(){return I().replace("-","").replace("_","")},q=new(function(){function e(){this.savedStyles=[],this.bodyScrollYValue=0,this.isFreezed=!1}return e.prototype.freezeBodyOverflow=function(){if(!this.isFreezed){this.isFreezed=!0;var e=(n=window.document.documentElement.clientWidth,Math.abs(window.innerWidth-n)),t=parseInt(window.getComputedStyle(window.document.body).paddingRight,10)||0;this.bodyScrollYValue=window.pageYOffset||window.scrollY,this.savedStyles=[],this.savedStyles.push({value:window.document.body.style.paddingRight,property:"padding-right"},{value:window.document.body.style.overflow,property:"overflow"},{value:window.document.body.style.overflowX,property:"overflow-x"},{value:window.document.body.style.overflowY,property:"overflow-y"}),window.document.body.style.setProperty("overflow","hidden"),window.document.body.style.setProperty("padding-right",e+t+"px")}var n},e.prototype.restoreBodyOverflow=function(){this.isFreezed&&(this.savedStyles.forEach((function(e){var t=e.value,n=e.property;t?window.document.body.style.setProperty(n,t):window.document.body.style.removeProperty(n)})),window.scrollTo(0,this.bodyScrollYValue),this.isFreezed=!1)},e}());!function(e){e.OPEN="VKSDKOpen",e.CLOSE="VKSDKClose",e.LOGOUT="VKSDKLogout",e.GET_CAPTCHA="VKSDKGetCaptcha",e.CAPTCHA_SUCCESS="VKSDKGetCaptchaSuccess",e.CAPTCHA_FAILED="VKSDKGetCaptchaFail",e.AUTH_NEEDED="VKSDKAuthNeeded",e.UPDATE_PARAMS="VKSDKUpdateParams",e.REQUEST_SUPERAPP_TOKEN="VKSDKRequestSuperAppToken",e.ERROR="VKSDKError"}(W||(W={})),function(e){e.INIT="VKSDKInit"}(F||(F={})),function(e){e[e.UNKNOWN=1]="UNKNOWN",e[e.MISSING_PARAM=2]="MISSING_PARAM",e[e.CONNECTION_LOST=3]="CONNECTION_LOST",e[e.USER_DENIED=4]="USER_DENIED",e[e.INVALID_PARAMS=5]="INVALID_PARAMS",e[e.CUSTOM=6]="CUSTOM",e[e.LOADING_ERROR=7]="LOADING_ERROR",e[e.CONNECT_WINDOW_CLOSED=7]="CONNECT_WINDOW_CLOSED",e[e.CONNECT_WINDOW_NOT_OPENED=8]="CONNECT_WINDOW_NOT_OPENED",e[e.CONNECT_DOMAIN_NOT_ALLOWED=9]="CONNECT_DOMAIN_NOT_ALLOWED",e[e.CONNECT_UNKNOWN_SDK_MESSAGE=10]="CONNECT_UNKNOWN_SDK_MESSAGE",e[e.CONNECT_CLIENT_SDK_ERROR=11]="CONNECT_CLIENT_SDK_ERROR",e[e.VALIDATE_ERROR=12]="VALIDATE_ERROR",e[e.CAPTCHA_ERROR=14]="CAPTCHA_ERROR",e[e.OLD_MISSING_PARAM=100]="OLD_MISSING_PARAM"}(z||(z={}));var Z=function(e,t){return'Wrong "'+e+'" param. '+(t||"")},J=function(){return"Connect window was closed."},Q=function(){return"Connect window was not opened."},X=function(e){return'URL domain "'+e+'" is not allowed.'},$=function(e){return"This SDK message is unknown: "+e},ee=function(e){return e.error+";"+e.errorCode},te=function(){return"Loading timeout"},ne=function(e){return"The "+e+" parameter must be a number"},re=function(e){return"The "+e+" parameter must be a string"},oe=function(e){return"The "+e+" is required parameter"},ie=function(e){return"The "+e+" parameter must be a number or a string"},ae=function(e){return"The "+e+" parameter must be а function"},se=function(e,t){return(se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function ce(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}se(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var ue,le,pe,de,he=function(){return(he=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function fe(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map((function(e){e(n)})),(e["*"]||[]).slice().map((function(e){e(t,n)}))}}}function me(e){return"number"==typeof e}function ve(e){return"string"==typeof e}function ge(e){return void 0!==e&&""!==e&&null!==e}function _e(e){return"function"==typeof e}function ye(e,t,n,r){return{type:e,code:t,message:n,params:r}}function Ae(e,t){return{type:z[z.VALIDATE_ERROR],code:z.VALIDATE_ERROR,message:e,params:t}}function Ee(e){return e.message?{code:e.code,reason:e.message,data:e.params}:{code:e.code,data:e.params}}!function(e){e.GET_CAPTCHA="VKSDKGetCaptcha",e.APP_CLOSE="VKWebAppClose",e.APP_READY="VKSDKMiniAppReady",e.RESIZE="VKSDKMiniAppResize",e.APP_INIT_CONFIG="VKSDKMiniAppInitConfig",e.OPEN_APP="VKWebAppOpenApp",e.OPEN_PAY_FORM="VKWebAppOpenPayForm",e.ACTION_DONE="VKWebAppActionDone",e.SET_TITLE="VKWebAppSetTitle",e.AUTH_BY_EXCHANGE_TOKEN="VKWebAppAuthByExchangeToken",e.FORCE_LOGOUT="VKWebAppForceLogout"}(ue||(ue={})),function(e){e.OPEN="open",e.HIDE="hide",e.CLOSE="close",e.SHOW="show",e.MESSAGE="message",e.CREATE_APP="createapp"}(le||(le={})),function(e){e.SUPERAPP_TOKEN="VKSDKGeneralSuperAppToken",e.AUTH_NEEDED="VKSDKGeneralAuthNeeded",e.OPEN_APP="VKSDKGeneralOpenApp"}(pe||(pe={})),function(e){e.SUPERAPP_TOKEN_CHANGE_V2="superAppTokenV2",e.SUPERAPP_TOKEN_CHANGE="superAppToken"}(de||(de={}));var Te,Se=function(){function e(e,t,n){void 0===e&&(e="Parameter validation error"),this.errorText=e,this.params=t,this.valid=n}return e.prototype.isValid=function(){return Boolean(this.valid)},e.prototype.error=function(e){return this.isValid()?null:e?Ee(Ae(this.errorText,this.params)):Ae(this.errorText,this.params)},e}(),Oe=function(){function e(e){this.rules=e}return e.prototype.validate=function(e){for(var t in this.rules)if(this.rules.hasOwnProperty(t))for(var n=0;n<this.rules[t].length;n++){var r=this.rules[t][n];if(!r.rule(e[t]))return new Se(r.errorText,e,!1)}return new Se("",e,!0)},e}(),we=(new Oe({params:[{rule:ge,errorText:oe("params")}]}),new Oe({token:[{rule:ve,errorText:re("token")}]})),Ce=new Oe({event:[{rule:ve,errorText:re("event")},{rule:ge,errorText:oe("event")}],handler:[{rule:ge,errorText:oe("handler")}]}),be=new Oe({app:[{rule:function(e){return me(e)||ve(e)},errorText:ie("app")},{rule:ge,errorText:oe("app")}]}),Pe=new Oe({message:[{rule:ge,errorText:oe("message")}]}),De=new Oe({handler:[{rule:ge,errorText:oe("handler")},{rule:_e,errorText:ae("handler")}]}),Ie=new Oe({handler:[{rule:ge,errorText:oe("handler")},{rule:_e,errorText:ae("handler")}]}),Ne=new Oe({handler:[{rule:ge,errorText:oe("handler")},{rule:_e,errorText:ae("handler")}]}),ke=new Oe({appId:[{rule:me,errorText:ne("appId")}]}),Re={appId:0,superAppToken:"",superAppTokenV2:"",loginDomain:"login.vk.com",oauthDomain:"oauth.vk.com",connectDomain:"id.vk.com",_debug:!1,_localhost:!1},xe={},Ke=function(){function e(){}return e.init=function(e){if(!e.appId)throw new Error("appId required");var t=ke.validate({appId:e.appId});!t.isValid()&&console.error(t.error()),Re.appId=e.appId,Re.superAppToken=e.superAppToken||"",Re.superAppTokenV2=e.superAppTokenV2||"",Re.loginDomain=e.loginDomain||"login.vk.com",Re.oauthDomain=e.oauthDomain||"oauth.vk.com",Re.connectDomain=e.connectDomain||"id.vk.com",Re.appSettings=e.appSettings,Re._debug=!!e._debug,Re._localhost=!!e._localhost},e.get=function(){return Re},e.setSuperAppToken=function(t,n){void 0===n&&(n={});var r=we.validate({token:t});!r.isValid()&&console.error(r.error()),2===n.version?(Re.superAppTokenV2=t,e.events.emit(de.SUPERAPP_TOKEN_CHANGE_V2,t)):(Re.superAppToken=t,e.events.emit(de.SUPERAPP_TOKEN_CHANGE,t))},e.onRequestSuperAppToken=function(e){var t=De.validate({handler:e});!t.isValid()&&console.error(t.error()),xe.requestSuperAppToken=e},e._requestSuperAppToken=function(t,n){var r;void 0===n&&(n={}),xe.requestSuperAppToken&&(r=xe.requestSuperAppToken(t,n)),r&&r.then((function(t){return e.setSuperAppToken(t,n)})).catch(console.error)},e.onAuth=function(e){var t=Ie.validate({handler:e});!t.isValid()&&console.error(t.error()),xe.auth=e},e._auth=function(t){var n;void 0===t&&(t={}),xe.auth&&(n=xe.auth()),n&&n.then((function(n){e.setSuperAppToken(n,t)})).catch(console.error)},e.onOpenApp=function(e){xe.openApp=e},e._openApp=function(e){xe.openApp&&xe.openApp(e.app)},e.onLogout=function(e){var t=Ne.validate({handler:e});!t.isValid()&&console.error(t.error()),xe.logout=e},e._logout=function(){xe.logout&&xe.logout()},e.fetchDomain=function(){return Boolean(Te)||(Te=new Promise((function(e){fetch("https://vk.ru/domain.txt").then((function(e){return e.text()})).then((function(e){return e.trim()})).then((function(e){Re.loginDomain=Re.loginDomain.replace("vk.com",e),Re.oauthDomain=Re.oauthDomain.replace("vk.com",e),Re.connectDomain=Re.connectDomain.replace("vk.com",e)})).then(e).catch((function(t){e(),console.warn(t)}))}))),Te},e.events=fe(),e}(),Me=new Oe({iframe:[{rule:ge,errorText:oe("iframe")}],origin:[{rule:ve,errorText:re("origin")},{rule:ge,errorText:oe("origin")}]}),Le=new Oe({event:[{rule:ge,errorText:oe("event")}]}),Ve=new Oe({handler:[{rule:ge,errorText:oe("handler")},{rule:_e,errorText:ae("handler")}]}),Ue=new Oe({handler:[{rule:ge,errorText:oe("handler")}],params:[{rule:ge,errorText:oe("params")}]}),He=function(e){var t=this;this.handler=function(){return{}},this.destroy=function(){delete t.config,window.removeEventListener("message",t.handleMessage)},this.onMessage=function(e){var n=Ve.validate({handler:e});!n.isValid()&&console.error(n.error()),t.handler=e},this.sendMessage=function(e){var n,r=Ue.validate(e);!r.isValid()&&console.error(r.error()),null===(n=t.config.iframe.contentWindow)||void 0===n||n.postMessage(he({type:"vk-sak-sdk"},e),t.config.origin)},this.handleMessage=function(e){var n=Le.validate({event:e});!n.isValid()&&console.error(n.error()),t.config.origin&&e.origin===t.config.origin&&e.source===t.config.iframe.contentWindow&&e.data&&"vk-sak-sdk"===e.data.type&&t.handler(e.data)};var n=Me.validate(e);!n.isValid()&&console.error(n.error()),this.config=e,window.addEventListener("message",this.handleMessage)},Ge=function(){function e(){var e=this;this.resolve=function(t){if(Boolean(e.promise))return e.finished=!0,e.active=!1,e.resolveHandler(t)},this.reject=function(t){if(Boolean(e.promise))return e.finished=!0,e.active=!1,e.rejectHandler(t)}}return e.prototype.start=function(){var e=this;this.active=!0,this.finished=!1,this.promise=new Promise((function(t,n){e.resolveHandler=t,e.rejectHandler=n}))},e.prototype.get=function(){return this.promise},e}(),Be=["extend_token","login_with_user","login_silent_user","__sferum_invite_link","registration_with_phone","registration_with_email","validate_phone","bind_ok_account","no_password_flow","confirm_service_action","login_with_eljour","login_with_edu_profile","login_with_multi_user","auth_validation_phone","qr_auth","multi_account_flow"];function We(e){return e&&Be.includes(e.name)?btoa(JSON.stringify(e)):""}function Fe(e){return e?btoa(JSON.stringify(e)):""}function ze(e,t){return void 0===t&&(t="auth"),Ke.fetchDomain().then((function(){var n=Ke.get(),r=n.appId,o=n.connectDomain,i=n.appSettings,a=n._debug,s=n._localhost,c=he({app_id:r,response_type:"silent_token",v:"1.60.0",debug:a?1:null,localhost:s?1:null},e);i&&L(i)&&(c.app_settings=V(i));var u=K(c);return Promise.resolve("https://"+o+"/"+t+"?"+u)}))}var je,Ye=[r,o,i,a,s,c,u,l];!function(e){e.Default="default",e.NamePhone="name_phone",e.PhoneName="phone_name"}(je||(je={}));var qe,Ze=[je.Default,je.NamePhone,je.PhoneName];!function(e){e.Primary="primary",e.Flat="flat"}(qe||(qe={}));var Je=[qe.Primary,qe.Flat];var Qe;!function(e){e.CAPTCHA_SUCCESS="VKSDKAuthCaptchaSuccess",e.CAPTCHA_FAIL="VKSDKAuthCaptchaFail"}(Qe||(Qe={}));var Xe,$e=function(e,t,n){var r=this;this.events=fe(),this.showReadyPromiseTask=new Ge,this.init=function(){Ke.fetchDomain().then((function(){ze(he(he({origin:location.protocol+"//"+location.host,uuid:r.uuid},r.captchaData),{scheme:r.scheme}),"auth_captcha").then(r.handleCaptcha)}))},this.createFrame=function(){return r.iframe=U("",{cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100vh;\n      min-height: 100vh;\n      border: none;\n      z-index: 99999;\n     "}),r},this.handleError=function(e){var t=Ee(ye(z[z.CUSTOM],z.CUSTOM,"",e));r.events.emit(W.ERROR,t)},this.onMessage=function(e){switch(e.handler){case W.ERROR:r.handleError(e.params);break;case Qe.CAPTCHA_SUCCESS:r.showReadyPromiseTask.resolve(e.params),r.destroy();break;default:r.showReadyPromiseTask.reject(),r.destroy()}},this.handleCaptcha=function(e){r.iframe.src=e,document.body.appendChild(r.iframe),r.bridge=new He({iframe:r.iframe,origin:"https://"+Ke.get().connectDomain}),r.bridge.onMessage(r.onMessage)},this.destroy=function(){r.iframe&&document.body.removeChild(r.iframe),r.bridge&&r.bridge.destroy()},this.show=function(){return r.iframe.style.display="block",new Promise((function(e){r.showReadyPromiseTask.start(),r.showReadyPromiseTask.get().then(e)}))},this.uuid=e,this.captchaData=t,this.scheme=n||"bright_light",this.createFrame().init()},et=function(){function e(t){var n=this;this.readyPromiseResolve=null,this.readyPromise=null,this.child=null,this.initialTitle=window.document.title,this.open=function(e,t){return Ke.fetchDomain().then((function(){return n.loading?(n.getMiniAppUrl(e,t).then((function(e){n.iframe.src=e})),n.loading=new Promise((function(e){n.iframe.onload=function(){n.iframe.onload=null,e()}})),n.readyPromise=new Promise((function(e){return n.readyPromiseResolve=e})),n.eventOpenSettings(),n.readyPromise):n.preload(e,t).catch(console.error)}))},this.eventOpenSettings=function(){n.iframe.style.display="block",n.params.stackMode||q.freezeBodyOverflow(),n.loading.then(n.handleResize).catch(console.error),n.events.emit(le.OPEN)},this.hide=function(){n.iframe.style.display="none",n.params.stackMode||q.restoreBodyOverflow(),n.events.emit(le.HIDE)},this.close=function(e){window.document.title!==n.initialTitle&&(window.document.title=n.initialTitle),n.params.stackMode||q.restoreBodyOverflow(),n.iframe&&n.iframe.remove(),n.bridge&&n.bridge.destroy(),delete n.iframe,delete n.bridge,Ke.events.off(de.SUPERAPP_TOKEN_CHANGE,n.onSuperAppToken),window.removeEventListener("resize",n.handleResize),n.events.emit(le.CLOSE,e)},this.show=function(){if(!n.loading)throw new Error('App is not loaded, use "open" or "preload" methods');n.iframe.style.display="block",n.params.stackMode||q.freezeBodyOverflow(),n.events.emit(le.SHOW)},this.preload=function(e,t){return Ke.fetchDomain().then((function(){var r=document.createElement("iframe"),o=window.innerHeight,i=isFinite(n.params.zIndex)?n.params.zIndex:999999;return n.getMiniAppUrl(e,t).then((function(e){r.src=e})),r.setAttribute("allow","geolocation"),r.style.cssText="\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+o+"px;\n      min-height: "+o+"px;\n      border: none;\n      z-index: "+i+";\n    ",n.iframe=r,document.body.appendChild(n.iframe),n.bridge=new He({iframe:n.iframe,origin:"https://"+Ke.get().connectDomain}),n.loading=new Promise((function(e){r.onload=function(){r.onload=null,e()}})),n.readyPromise=new Promise((function(e){return n.readyPromiseResolve=e})),n.bridge.onMessage(n.handleMessage),Ke.events.on(de.SUPERAPP_TOKEN_CHANGE,n.onSuperAppToken),window.addEventListener("resize",n.handleResize),n.eventOpenSettings(),n.loading}))},this.sendMessage=function(e){var t=Pe.validate({message:e});!t.isValid()&&console.error(t.error()),n.bridge.sendMessage(e)},this.onSuperAppToken=function(e){n.bridge.sendMessage({handler:pe.SUPERAPP_TOKEN,params:{result:e}})},this.handleError=function(e){var t=Ee(ye(z[z.CUSTOM],z.CUSTOM,"",e));n.events.emit(W.ERROR,t)},this.handleMessage=function(e){switch(e.handler){case W.GET_CAPTCHA:var t=e.params.uuid,r=new $e(t,{captcha_sid:e.params.captcha_sid,captcha_img:e.params.captcha_img});r.show().then((function(e){n.bridge.sendMessage({handler:W.CAPTCHA_SUCCESS,params:he({uuid:t},e)})})).catch((function(){n.bridge.sendMessage({handler:W.CAPTCHA_FAILED,params:{uuid:t}}),r.destroy()}));break;case ue.APP_CLOSE:n.hide();break;case W.ERROR:n.handleError(e.params);break;case ue.APP_READY:n.resolveReadyPromise(),n.handleUpdateConfig();break;case ue.OPEN_APP:n.openMiniapp(e.params);break;case ue.OPEN_PAY_FORM:n.openPayForm(e.params);break;case ue.SET_TITLE:n.setTitle(e.params);break;case ue.AUTH_BY_EXCHANGE_TOKEN:n.onAuthByExchangeToken();break;case ue.FORCE_LOGOUT:n.onForceLogout();break;case pe.SUPERAPP_TOKEN:Ke._requestSuperAppToken(e.params);break;case pe.AUTH_NEEDED:Ke._auth();break;default:n.events.emit(le.MESSAGE,e)}},this.handleResize=function(){if(n.iframe){var e=innerWidth,t=innerHeight;n.iframe.style.height=t+"px",n.iframe.style.minHeight=t+"px",n.bridge.sendMessage({handler:ue.RESIZE,params:{viewport_width:e,viewport_height:t}})}},this.handleUpdateConfig=function(){n.bridge.sendMessage({handler:ue.APP_INIT_CONFIG,params:{fullMode:n.params.fullMode,hideMenu:n.params.hideMenu,scheme:n.params.scheme}})},this.update=function(e){e&&(n.params=H(n.params,e||{}),n.sendUpdateParamsMessage())},this.getMiniAppUrl=function(e,t){return Ke.fetchDomain().then((function(){var r=Ke.get(),o=r.connectDomain,i=r.appId,a=r.superAppToken,s=r._debug,c=r._localhost;return"https://"+o+"/mini_app?"+K({app:n.params.app,host_app_id:i,superapp_token:a,app_query:e?JSON.stringify(e):"",app_hash:t||"",debug:s?1:null,localhost:c?1:null})}))},this.resolveReadyPromise=function(){n.readyPromise&&n.readyPromiseResolve&&(n.readyPromiseResolve(),n.readyPromise=null,n.readyPromiseResolve=null)},this.openMiniapp=function(t){n.child=new e({app:t.app_id,stackMode:n.params.stackMode}),n.events.emit(le.CREATE_APP,{app:n.child,location:t.location})},this.openPayForm=function(t){var r=he({},t.params);r.data&&(r.data=JSON.stringify(r.data));var o=he(he({},r),{app_id:t.app_id,action:t.action}),i=new e({app:6217559,stackMode:n.params.stackMode});i.open(o).then((function(){return n.hide()})).catch(console.error),i.events.on(le.MESSAGE,(function(e){n.handleVKPayFormMessage(e),i.close(),n.show()})),i.events.on(le.HIDE,(function(){i.close(),n.close()}))},this.setTitle=function(e){window.document.title=e.title},this.onAuthByExchangeToken=function(){n.close({closedByExchangeToken:!0})},this.onForceLogout=function(){n.close({closedByForceLogout:!0})},this.handleVKPayFormMessage=function(e){e.handler===ue.ACTION_DONE&&n.sendMessage(e),e.handler===W.ERROR&&n.handleError(e.params)};var r=be.validate(t);!r.isValid()&&console.error(r.error()),this.params=he(he({},t),{app:"number"==typeof t.app?"app"+t.app:t.app,scheme:"string"==typeof t.scheme?t.scheme:"bright_light"}),this.events=fe()}return e.prototype.on=function(e,t){var n=Ce.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},e.prototype.off=function(e,t){var n=Ce.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},e.prototype.sendUpdateParamsMessage=function(){this.bridge&&this.bridge.sendMessage({params:this.params,handler:W.UPDATE_PARAMS})},e}(),tt=function(){function e(){this.stack=[]}return e.prototype.removeMiniApp=function(e){var t=e.app,n=this.stack.lastIndexOf(t);if(n>-1&&n===this.stack.length-1)if(this.stack.splice(n,1),this.stack.length){this.stack[this.stack.length-1].show();var r=this.stack[this.stack.length-2];setTimeout((function(){return null==r?void 0:r.hide()}),0)}else q.restoreBodyOverflow()},e.prototype.makeHandleMiniAppClose=function(e){var t=this,n=e.app;return function(){t.removeMiniApp({app:n})}},e.prototype.makeHandleMiniAppHide=function(e){var t=this,n=e.app;return function(){var e=t.stack.lastIndexOf(n);e>-1&&e===t.stack.length-1&&setTimeout((function(){return n.close()}),0)}},e.prototype.handleMiniAppCreate=function(e){var t=e.app,n=e.query,r=e.hash;this.stack.push(t),t.open(n,r).catch(console.error),t.events.on(le.CREATE_APP,this.handleMiniAppCreate.bind(this)),t.events.on(le.HIDE,this.makeHandleMiniAppHide({app:t})),t.events.on(le.CLOSE,this.makeHandleMiniAppClose({app:t})),q.freezeBodyOverflow();var o=this.stack[this.stack.length-2];return setTimeout((function(){null==o||o.hide()}),0),t},Object.defineProperty(e.prototype,"length",{get:function(){return this.stack.length},enumerable:!1,configurable:!0}),e.prototype.open=function(e){var t=be.validate(e);!t.isValid()&&console.error(t.error());var n=e.app,r=e.query,o=e.hash,i=new et({app:n,stackMode:!0});return this.handleMiniAppCreate({app:i,query:r,hash:o}),i},e.prototype.close=function(){var e=this.stack;this.stack.splice(0),e.reverse().forEach((function(e){return e.close()})),q.restoreBodyOverflow()},e}();!function(e){e.STATIC_MAP="VKSDKRequestToGeoservice:staticmap/png/",e.SEARCH="VKSDKRequestToGeoservice:search",e.OVERALL="VKSDKRequestToGeoservice:overall",e.DIRECTIONS="VKSDKRequestToGeoservice:directions",e.ISO="VKSDKRequestToGeoservice:iso"}(Xe||(Xe={}));var nt,rt,ot,it,at,st,ct=function(){function e(e){var t=this;this.apiKey=e.apiKey,this.requestMap={};var n=document.createElement("iframe");this.iframe=n,Ke.fetchDomain().then((function(){var e=Ke.get().appId;t.getGeoserviceProxyUrl({app_id:e}).then((function(e){n.src=e})),n.style.cssText="\n      display: none;\n    ",document.body.appendChild(t.iframe),t.bridge=new He({iframe:t.iframe,origin:"https://"+Ke.get().connectDomain}),t.bridge.onMessage((function(e){var n=e.params,r=n.requestID,o=n.response;t.requestMap[r].resolve(o),delete t.requestMap[r]}))}))}return e.prototype.setApiKey=function(e){this.apiKey=e},e.prototype.getGeoserviceProxyUrl=function(e){return Ke.fetchDomain().then((function(){var t=Ke.get(),n=t.connectDomain,r=t._debug,o=t._localhost;return"https://"+n+"/geoservice?"+K(he(he({},e||{}),{origin:location.protocol+"//"+location.host,debug:r?1:null,localhost:o?1:null}))}))},e.prototype.prepareAnswer=function(e,t,n){var r=this,o=I();return this.bridge.sendMessage({handler:"VKSDKRequestToGeoservice:"+e,params:he(he({},t),{api_key:this.apiKey,wrapRequestInJSON:n,requestID:o})}),new Promise((function(e,t){r.requestMap[o]={resolve:e,reject:t}}))},e.prototype.getStaticMap=function(e){return this.prepareAnswer("staticmap/png/",e)},e.prototype.encodeCoords=function(e){return this.prepareAnswer("search",e)},e.prototype.decodeCoords=function(e){return this.prepareAnswer("overall",e)},e.prototype.getDirections=function(e){return this.prepareAnswer("directions",e,!0)},e.prototype.getISO=function(e){return this.prepareAnswer("iso",e,!0)},e}();!function(e){e.SHOW_DATA_POLICY="VKSDKOneTapAuthConnectDataPolicy",e.HIDE_DATA_POLICY="VKSDKOneTapAuthDataPolicyClose",e.DATA_POLICY_RESULT="VKSDKOneTapAuthDataPolicyResult",e.SHOW_CAPTCHA="VKSDKOneTapAuthDataPolicyShowCaptcha"}(nt||(nt={})),function(e){e.SHOW_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsShow",e.HIDE_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsHide",e.ACCEPT_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsAccept",e.DECLINE_POLICY_AGREEMENTS="VKSDKOneTapAuthPolicyAgreementsDecline",e.POLICY_AGREEMENTS_ERROR="VKSDKOneTapAuthPolicyAgreementsError",e.SHOW_DATA_POLICY="VKSDKOneTapAuthPolicyAgreementsShowDataPolicy",e.GET_CAPTCHA="VKSDKGetCaptcha",e.CAPTCHA_SUCCESS="VKSDKGetCaptchaSuccess",e.CAPTCHA_FAIL="VKSDKGetCaptchaFail"}(rt||(rt={})),function(e){e.PHONE_VALIDATION_NEEDED="VKSDKOneTapAuthPhoneValidationNeeded",e.FULL_AUTH_NEEDED="VKSDKOneTapAuthFullAuthNeeded",e.AUTH_DATA_LOADED="VKSDKOneTapAuthDataLoaded",e.NOT_AUTHORIZED="VKSDKOneTapAuthNotAuthorized",e.LOGIN_SUCCESS="VKSDKOneTapAuthLoginSuccess",e.LOGIN_FAILED="VKSDKOneTapAuthLoginFailed",e.RESIZE_FRAME="VKSDKOneTapResizeFrame",e.SHOW_CAPTCHA="VKSDKOneTapShowCaptcha",e.VALIDATE_CAPTCHA="VKSDKOneTapValidateCaptcha",e.UPDATE_PARAMS="VKSDKUpdateParams",e.AUTHORIZE_NEEDED="VKSDKButtonOneTapAuthAuthorizeNeeded"}(ot||(ot={})),function(e){e.CLOSE_AUTH="VKSDKOneTapAuthClose",e.ADAPTIVITY_CHANGE="VKSDKFloatingOneTapAdaptivityChange",e.ADAPTIVITY_CHANGED="VKSDKFloatingOneTapAdaptivityChanged",e.UPDATE_PARAMS="VKSDKUpdateParams"}(it||(it={})),function(e){e.SHOW_LOGIN="VKSDKButtonOneTapAuthShowLogin",e.SHOW_LOGIN_OPTIONS="VKSDKButtonOneTapAuthShowLoginOptions",e.SHOW_AGREEMENTS_DIALOG="VKSDKButtonOneTapAuthShowAgreementsDialog",e.START_AUTHORIZE="VKSDKButtonOneTapAuthStartAuthorize",e.UPDATE_PARAMS="VKSDKUpdateParams"}(at||(at={})),function(e){e.WRONG_TOKEN="VKSDKBindAccountErrorWrongToken",e.ALREADY_BIND="VKSDKBindAccountErrorAlreadyBind"}(st||(st={}));var ut,lt=new Oe({url:[{rule:ve,errorText:re("url")},{rule:ge,errorText:oe("url")}]}),pt=new Oe({uuid:[{rule:ve,errorText:re("uuid")},{rule:ge,errorText:oe("uuid")}]}),dt=(new Oe({params:[{rule:ge,errorText:oe("params")}]}),new Oe({callback:[{rule:ge,errorText:oe("callback")}]})),ht=function(){function e(){}return e.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e}(),ft=new Oe({params:[{rule:ge,errorText:oe("params")}]}),mt=function(){function e(){var e=this;this.config={},this.params={},this.loadingTask=new Ge,this.initTask=new Ge,this.cssText="",this.handleError=function(t){var n=Ee(ye(z[z.CUSTOM],z.CUSTOM,"",t));e.events.emit(W.ERROR,n)},this.events=fe(),this.handleBridgeMessage=this.handleBridgeMessage.bind(this),this.handleChangeSuperAppToken=this.handleChangeSuperAppToken.bind(this),this.close=this.close.bind(this),this.handleLogout=this.handleLogout.bind(this)}return e.prototype.preload=function(e){var t=this;return Ke.fetchDomain().then((function(){return t.validateParams(e).then((function(){return t.updateParams(e),t.createIframe().then((function(){return t.initTask.start(),t.loadingTask.start(),t.timeoutTimer=setTimeout((function(){if(!t.initTask.finished){var e=Ee(ye(z[z.LOADING_ERROR],z.LOADING_ERROR,te()));t.initTask.reject(e)}}),5e3),t.iframe.onload=function(){t.iframe.onload=null,t.loadingTask.resolve()},t.bridge=new He({iframe:t.iframe,origin:"https://"+Ke.get().connectDomain}),t.bridge.onMessage(t.handleBridgeMessage),Ke.events.on(de.SUPERAPP_TOKEN_CHANGE_V2,t.handleChangeSuperAppToken),Ke.events.on(W.LOGOUT,t.close),t.getIframeContainer().appendChild(t.iframe),t.loadingTask.get()}))}))}))},e.prototype.open=function(e){var t=this;return this.validateParams(e).then((function(){return t.initTask.finished?(t.updateParams(e),Promise.resolve()):t.initTask.active||t.initTask.finished?(t.updateParams(e),t.initTask.get()):t.preload(e).then((function(){return t.initTask.get()}))}))},e.prototype.update=function(e,t){e&&this.updateParams(e),t&&this.updateConfig(t)},e.prototype.close=function(){this.iframe&&(this.iframe.onload=null,this.iframe.remove()),this.bridge&&this.bridge.destroy(),Ke.events.off(de.SUPERAPP_TOKEN_CHANGE_V2,this.handleChangeSuperAppToken),Ke.events.off(W.LOGOUT,this.close),delete this.iframe,delete this.bridge,this.loadingTask=new Ge,this.initTask=new Ge,this.events.emit(W.CLOSE)},e.prototype.sendMessage=function(e){var t=Pe.validate({message:e});!t.isValid()&&console.error(t.error()),this.bridge.sendMessage(e)},e.prototype.on=function(e,t){var n=Ce.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},e.prototype.off=function(e,t){var n=Ce.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},e.prototype.handleInit=function(){this.initTask.finished||(clearTimeout(this.timeoutTimer),this.initTask.resolve()),this.sendUpdateParamsMessage(),this.iframe.style.display="block"},e.prototype.handleRequestAuth=function(){Ke._auth({version:2})},e.prototype.handleRequestSuperAppToken=function(e){Ke._requestSuperAppToken(e,{version:2})},e.prototype.handleChangeSuperAppToken=function(e){this.bridge.sendMessage({handler:W.REQUEST_SUPERAPP_TOKEN+"Success",params:{result:e}})},e.prototype.handleBridgeMessage=function(e){switch(ht.log(e),e.handler){case F.INIT:this.handleInit();break;case W.REQUEST_SUPERAPP_TOKEN:this.handleRequestSuperAppToken(e.params);break;case W.AUTH_NEEDED:this.handleRequestAuth();break;case W.CLOSE:this.close();break;case W.ERROR:this.handleError(e.params);break;default:return}},e.prototype.handleLogout=function(){Ke._logout()},e.prototype.handleAfterUpdateParams=function(){this.sendUpdateParamsMessage()},e.prototype.handleAfterUpdateConfig=function(){},e.prototype.handleAfterCreateIframe=function(){},e.prototype.validateParams=function(e){var t=ft.validate({params:e});return!t.isValid()&&console.error(t.error()),Promise.resolve(e)},e.prototype.createIframe=function(){var e=this;return this.getIframeUrl().then((function(t){return e.iframe=U(t,{cssText:e.cssText}),e.handleAfterCreateIframe(),Promise.resolve()}))},e.prototype.getIframeUrl=function(){return new Promise((function(e){return e("")}))},e.prototype.getIframeContainer=function(){return window.document.body},e.prototype.getIframeUrlParams=function(){var e=this;return Ke.fetchDomain().then((function(){var t=Ke.get(),n=t.superAppTokenV2,r=t.appId,o=t._debug,i=t._localhost;return Promise.resolve(K(he(he({},e.params),{host_app_id:r,superapp_token:n,origin:location.protocol+"//"+location.host,debug:o?1:null,localhost:i?1:null})))}))},e.prototype.updateConfig=function(e){this.config=H(this.config,e),this.handleAfterUpdateConfig()},e.prototype.updateParams=function(e){this.params=H(this.params,e||{}),this.handleAfterUpdateParams()},e.prototype.sendUpdateParamsMessage=function(){this.bridge&&this.initTask.finished&&this.bridge.sendMessage({params:this.params,handler:W.UPDATE_PARAMS})},e}();!function(e){e.CLOSE="VKSDKAuthorizeClose",e.FAILED="VKSDKAuthorizeFailed",e.SUCCESS="VKSDKAuthorizeSuccess"}(ut||(ut={}));var vt=new Oe({scope:[{rule:ge,errorText:oe("scope")},{rule:ve,errorText:re("scope")}]}),gt=function(e){function t(t){var n=e.call(this)||this;n.cssText="\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 9999;\n    border: none;\n    display: none;\n  ";var r=vt.validate({scope:t.scope});return!r.isValid()&&console.error(r.error()),n.updateConfig(t),n}return ce(t,e),t.prototype.handleBridgeMessage=function(t){switch(e.prototype.handleBridgeMessage.call(this,t),t.handler){case ut.SUCCESS:t.params.code_verifier=this.codeVerifier,this.events.emit(ut.SUCCESS,t);break;case ut.FAILED:this.events.emit(ut.FAILED,t);break;case ut.CLOSE:this.close();break;default:return}},t.prototype.getIframeUrlParams=function(){var e=this;return Ke.fetchDomain().then((function(){var t,n,r,o=Ke.get(),i=o.appId,a=o._debug,s=o._localhost,c=I();return Promise.resolve(K(he(he({},e.params),{debug:a?1:null,localhost:s?1:null,client_id:i,code_challenge:e.codeChallenge,code_challenge_method:"s256",response_type:"code",state:c,origin:location.protocol+"//"+location.host,redirect_uri:null!==(t=e.config.redirect_uri)&&void 0!==t?t:location.protocol+"//"+location.host,device_id:null!==(n=e.config.device_id)&&void 0!==n?n:"",scope:null!==(r=e.config.scope)&&void 0!==r?r:""})))}))},t.prototype.open=function(t){return void 0===t&&(t={}),this.codeVerifier=Y(),this.codeChallenge=j(this.codeVerifier),e.prototype.open.call(this,t)},t.prototype.getIframeUrl=function(){var e=this;return Ke.fetchDomain().then((function(){return e.getIframeUrlParams().then((function(e){var t=Ke.get().connectDomain;return Promise.resolve("https://"+t+"/authorize?"+e)}))}))},t.prototype.handleAfterUpdateConfig=function(){this.updateZIndex()},t.prototype.handleAfterCreateIframe=function(){this.updateZIndex()},t.prototype.updateZIndex=function(){if(this.iframe){var e=this.config.zIndex;this.iframe.style.zIndex=""+e}},t}(mt),_t=function(){function e(){}var n;return e.on=function(e,t){var n=Ce.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.on(e,t)},e.off=function(e,t){var n=Ce.validate({event:e,handler:t});!n.isValid()&&console.error(n.error()),this.events.off(e,t)},n=e,e.flags=null,e.events=fe(),e.handleError=function(e){var t=Ee(ye(z[z.CUSTOM],z.CUSTOM,"",e));n.events.emit(W.ERROR,t)},e.silentAuth=function(){return Ke.fetchDomain().then((function(){var e=Ke.get(),t=e.loginDomain,n=e.appId,r=new Ge,o=I(),i="https://"+t+"/?act=connect&app_id="+n+"&response_type=silent_token&uuid="+o+"&v=1.60.0",a=new XMLHttpRequest;return a.open("GET",i,!0),a.responseType="json",a.withCredentials=!0,r.start(),a.onload=function(){var e,t=a.response,n=a.status>=200&&a.status<300;if(t&&(null===(e=t.error)||void 0===e?void 0:e.error_code)===z.CAPTCHA_ERROR){var s=t.error,c=s.captcha_sid,u=s.captcha_img;new $e(o,{captcha_sid:c,captcha_img:u}).show().then((function(e){var t=i+"&captcha_key="+e.captcha_key+"&captcha_sid="+e.captcha_sid;a.open("GET",t,!0),a.send()}))}else t&&n?r.resolve({provider:"vk",payload:a.response}):r.reject()},a.onerror=function(){r.reject()},a.send(),r.get()}))},e.oneTapAuth=function(t,n){if(console.warn("Connect.oneTapAuth method is deprecated. Use Connect.floatingOneTapAuth and Connect.buttonOneTapAuth methods."),!["floating","button"].includes(t))return null;switch(t){case"button":return e.buttonOneTapAuth(n);case"floating":return e.floatingOneTapAuth(n);default:return null}},e.floatingOneTapAuth=function(t){var r=dt.validate({callback:t.callback});!r.isValid()&&console.error(r.error());var o=function(){var e,t=window.innerWidth,n=t<=768;return{destroy:function(){return window.removeEventListener("resize",e)},isAdaptive:function(){return n},observe:function(r){e=function(){var e=window.innerWidth;t>768&&e<=768?r(n=!0):t<=768&&e>768&&r(n=!1),t=e},window.addEventListener("resize",e)}}}(),i=function(e,t){var n,r,o,i={},a=e?"314px":"334px",s=e?"\n      display: none;\n      position: fixed;\n      bottom: 0;\n      right: 50%;\n      transform: translate(50%, 0);\n      max-width: 468px;\n      width: 100%;\n      height: "+a+";\n    ":"\n        display: none;\n        position: fixed;\n        top: 0;\n        right: 0;\n        max-width: 400px;\n        width: 100%;\n        height: "+a+";\n      ";return(null===(n=null==t?void 0:t.styles)||void 0===n?void 0:n.zIndex)&&isFinite(null===(r=null==t?void 0:t.styles)||void 0===r?void 0:r.zIndex)&&(s+="z-index: "+(null===(o=null==t?void 0:t.styles)||void 0===o?void 0:o.zIndex)+";"),t&&(i.skip_success=G(t.skipSuccess,0),void 0!==t.scheme&&["bright_light","space_gray"].includes(t.scheme)&&(i.scheme=t.scheme)),{pageUrl:"floating_one_tap_auth",pageUrlParams:he({adaptive:e?1:0},i),frameStyles:s,scheme:(null==t?void 0:t.scheme)||"bright_light"}}(o.isAdaptive(),t.options),a=Y(),s=j(a);if(!i)throw new Error("options were not set");var c,u,l,p=I(),d=he({origin:location.protocol+"//"+location.host,uuid:p},i.pageUrlParams),h=i.pageUrl,f=new Ge,m=function(){u&&u.sendMessage({handler:ot.RESIZE_FRAME,params:{uuid:p}})},v=function(){c&&(c.remove(),c=null),window.removeEventListener("resize",m),o&&o.destroy(),u&&u.destroy()};l=new Promise((function(e){f.start(),f.get().then((function(t){e(t)}))}));var g=function(r){var o=r.params.uuid===p;if(r.params.code_verifier=a,o)switch(r.handler){case W.ERROR:n.handleError(r.params);break;case ot.NOT_AUTHORIZED:t.callback({type:r.handler,payload:{uuid:p,error:"not_authorized"}}),v(),f.resolve(r.handler);break;case ot.RESIZE_FRAME:c.style.height=r.params.height+"px";break;case it.CLOSE_AUTH:t.callback({type:r.handler,payload:{uuid:p}}),v();break;case it.ADAPTIVITY_CHANGED:c.style.display="block";break;case ot.AUTH_DATA_LOADED:c.style.display="block",f.resolve(r.handler);default:e.handleOneTapEvents(r,u,t)}};return c=U("",{cssText:null==i?void 0:i.frameStyles}),document.body.appendChild(c),Ke.fetchDomain().then((function(){return ze(he(he({},d),{code_challenge:s,code_challenge_method:"s256"}),h).then((function(e){c.src=e,(u=new He({iframe:c,origin:"https://"+Ke.get().connectDomain})).onMessage(g),o.observe((function(e){u.sendMessage({handler:it.ADAPTIVITY_CHANGE,params:{uuid:p,is_adaptive:e}}),e?(c.style.maxWidth="468px",c.style.top="auto",c.style.bottom="0",c.style.right="50%",c.style.transform="translate(50%, 0)"):(c.style.maxWidth="400px",c.style.top="0",c.style.bottom="auto",c.style.right="0",c.style.transform="none"),c.style.display="none"})),window.addEventListener("resize",m)}))})),{getFrame:function(){return c},destroy:v,authReadyPromise:l,update:function(e){i=H(i||{},e),u&&i&&u.sendMessage({handler:it.UPDATE_PARAMS,params:i})}}},e.buttonOneTapAuth=function(t){var n=dt.validate({callback:t.callback});!n.isValid()&&console.error(n.error());var o=function(e){var t,n,o,i,a,s,c={},u=44,l=56;return e&&(c.display=e.displayMode&&Ze.includes(e.displayMode)?e.displayMode:je.Default,c.button_skin=e.buttonSkin&&Je.includes(e.buttonSkin)?e.buttonSkin:qe.Primary,c.show_agreements=G(e.showAgreements,0),c.show_alternative_login=G(e.showAlternativeLogin,0),void 0!==e.scheme&&["bright_light","space_gray"].includes(e.scheme)&&(c.scheme=e.scheme),void 0!==(null===(t=e.buttonStyles)||void 0===t?void 0:t.height)&&(u=Number(null===(n=e.buttonStyles)||void 0===n?void 0:n.height),l=Number(null===(o=e.buttonStyles)||void 0===o?void 0:o.height)+12,c.style_height=null===(i=e.buttonStyles)||void 0===i?void 0:i.height),void 0!==(null===(a=e.buttonStyles)||void 0===a?void 0:a.borderRadius)&&(c.style_border_radius=null===(s=e.buttonStyles)||void 0===s?void 0:s.borderRadius),void 0!==e.langId&&(c.lang_id=Ye.includes(e.langId)?e.langId:r),u+=c.show_alternative_login?l:0,u+=c.show_agreements?80:0),{pageUrl:"button_one_tap_auth",pageUrlParams:c,frameStyles:"\n        height: "+u+"px;\n      ",scheme:(null==e?void 0:e.scheme)||"bright_light"}}(t.options),i=Y(),a=j(i);if(!o)throw new Error("options were not set");var s,c,u,l=I(),p=he({origin:location.protocol+"//"+location.host,uuid:l},o.pageUrlParams),d=o.pageUrl,h=new Ge;u=new Promise((function(e){h.start(),h.get().then((function(t){e(t)}))}));var f=function(){c&&c.sendMessage({handler:ot.RESIZE_FRAME,params:{uuid:l}})},m=function(n){var r=n.params.uuid===l;if(n.params.code_verifier=i,r)switch(n.handler){case ot.RESIZE_FRAME:s.style.height=n.params.height+"px";break;case ot.NOT_AUTHORIZED:h.resolve(n.handler);break;case at.SHOW_LOGIN:case at.SHOW_LOGIN_OPTIONS:t.callback({type:n.handler,payload:{uuid:l}});break;case at.SHOW_AGREEMENTS_DIALOG:e.userPolicyAgreements(l,null==o?void 0:o.scheme).show().then((function(e){e&&e.accepted&&c.sendMessage({handler:at.START_AUTHORIZE,params:{uuid:l}})})).catch((function(){c.sendMessage({handler:rt.DECLINE_POLICY_AGREEMENTS,params:{uuid:l}})}));break;case ot.AUTH_DATA_LOADED:h.resolve(n.handler);default:e.handleOneTapEvents(n,c,t)}};s=U("",{cssText:null==o?void 0:o.frameStyles});var v=t.container;return v&&v.appendChild(s),Ke.fetchDomain().then((function(){return ze(he(he({},p),{code_challenge:a,code_challenge_method:"s256"}),d).then((function(e){s.src=e,(c=new He({iframe:s,origin:"https://"+Ke.get().connectDomain})).onMessage(m),window.addEventListener("resize",f)}))})).catch(console.error),{getFrame:function(){return s},destroy:function(){s&&(s.remove(),s=null),window.removeEventListener("resize",f),c&&c.destroy()},authReadyPromise:u,update:function(e){o=H(o||{},e),c&&o&&c.sendMessage({handler:at.UPDATE_PARAMS,params:o})}}},e.handleOneTapEvents=function(t,r,o){var i,a,s=t.params.uuid;switch(t.handler){case W.ERROR:n.handleError(t.params);break;case ot.AUTH_DATA_LOADED:r.sendMessage({handler:ot.RESIZE_FRAME,params:{uuid:s}});break;case ot.LOGIN_SUCCESS:o.callback({type:t.handler,provider:"vk",payload:t.params});break;case ot.SHOW_CAPTCHA:var c=new $e(s,{captcha_sid:t.params.captcha_sid,captcha_img:t.params.captcha_img},null===(i=o.options)||void 0===i?void 0:i.scheme);c.show().then((function(e){r.sendMessage({handler:Qe.CAPTCHA_SUCCESS,params:he({uuid:s},e)})})).catch((function(){r.sendMessage({handler:Qe.CAPTCHA_FAIL,params:{uuid:s}}),c.destroy()}));break;case nt.SHOW_DATA_POLICY:e.userDataPolicy(s,null===(a=o.options)||void 0===a?void 0:a.scheme).show().then((function(){o.callback({type:nt.DATA_POLICY_RESULT,payload:{uuid:s,policyAccepted:!0}})})).catch((function(){o.callback({type:nt.DATA_POLICY_RESULT,payload:{uuid:s,policyAccepted:!1}})}));break;case ot.AUTHORIZE_NEEDED:var u={scope:t.params.scope,device_id:t.params.device_id},l=new gt(u);l.open({}).catch((function(e){console.error(e),l.close()}));var p=function e(t){var n=t.params,r=n.uuid,i=n.code,a=n.code_verifier,s=r&&i?ot.LOGIN_SUCCESS:ot.LOGIN_FAILED;o.callback({type:s,provider:"vk",payload:{code:i,state:r,code_verifier:a}}),l.close(),l.off(ut.SUCCESS,e),l.off(ut.FAILED,e)};l.on(ut.SUCCESS,p),l.on(ut.FAILED,p);break;case ot.FULL_AUTH_NEEDED:case ot.PHONE_VALIDATION_NEEDED:o.callback({type:t.handler,payload:{uuid:s}})}},e.userDataPolicy=function(e,t){var r,o=pt.validate({uuid:e});!o.isValid()&&console.error(o.error());var i,a=window.innerHeight,s=function(){r&&(r.style.display="none")},c=new Ge,u=function(){r&&r.remove(),i&&i.destroy()};r=U("",{properties:{height:a+"px"},cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100vh;\n      min-height: 100vh;\n      border: none;\n      z-index: 99999;\n    "}),document.body.appendChild(r);var l=function(o){switch(o.handler){case W.ERROR:n.handleError(o.params);break;case nt.HIDE_DATA_POLICY:s(),c.resolve(void 0),u();break;case nt.SHOW_CAPTCHA:var a=new $e(e,{captcha_sid:o.params.captcha_sid,captcha_img:o.params.captcha_img},t);a.show().then((function(t){i.sendMessage({handler:Qe.CAPTCHA_SUCCESS,params:he({uuid:e},t)}),r.style.display="block"})).catch((function(){i.sendMessage({handler:Qe.CAPTCHA_FAIL,params:{uuid:e}}),a.destroy()})),s();break;default:s(),c.reject(),u()}};return Ke.fetchDomain().then((function(){ze({origin:location.protocol+"//"+location.host,uuid:e,scheme:t||"bright_light"},"user_data_policy").then((function(e){r.src=e})),(i=new He({iframe:r,origin:"https://"+Ke.get().connectDomain})).onMessage(l)})),{show:function(){return r.style.display="block",new Promise((function(e){c.start(),c.get().then((function(t){e(t)}))}))},hide:s,destroy:u}},e.userPolicyAgreements=function(t,r){var o,i,a,s,c=new Ge;a="",s=window.innerHeight,o=U(a,{properties:{height:s+"px"},cssText:"\n      display: none;\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: "+s+"px;\n      min-height: "+s+"px;\n      border: none;\n      z-index: 99999;\n    "}),document.body.appendChild(o);var u=function(){o&&(o.remove(),o=null),i&&i.destroy()},l=function(){o&&(o.style.display="none")},p=function(a){switch(a.handler){case W.ERROR:n.handleError(a.params);break;case rt.ACCEPT_POLICY_AGREEMENTS:l(),c.resolve({accepted:!0}),u();break;case rt.DECLINE_POLICY_AGREEMENTS:l(),c.resolve({accepted:!1}),u();break;case rt.GET_CAPTCHA:var s=new $e(t,{captcha_sid:a.params.captcha_sid,captcha_img:a.params.captcha_img},r);s.show().then((function(e){i.sendMessage({handler:rt.CAPTCHA_SUCCESS,params:he({uuid:t},e)}),o.style.display="block"})).catch((function(){i.sendMessage({handler:rt.CAPTCHA_FAIL,params:{uuid:t}}),s.destroy()})),l();break;case rt.SHOW_DATA_POLICY:l();var p=function(){o.style.display="block"};e.userDataPolicy(t,r).show().then(p).catch(p);break;case rt.POLICY_AGREEMENTS_ERROR:case rt.HIDE_POLICY_AGREEMENTS:default:c.reject(),u()}};return Ke.fetchDomain().then((function(){ze({origin:location.protocol+"//"+location.host,uuid:t,scheme:r||"bright_light"},"user_policy_agreements").then((function(e){o.src=e,(i=new He({iframe:o,origin:"https://"+Ke.get().connectDomain})).onMessage(p)}))})),{show:function(){return o.style.display="block",new Promise((function(e){c.start(),c.get().then((function(t){e(t)}))}))},hide:l,destroy:u}},e.userVisibleAuth=function(n){return Ke.fetchDomain().then((function(){var r=I(),o=Ke.get(),i=he(he({origin:location.protocol+"//"+location.host,uuid:r,debug:o._debug?1:null,localhost:o._localhost?1:null},B(n,["screen","source"])),{scheme:null==n?void 0:n.scheme}),a=We(null==n?void 0:n.action);a&&(i.action=a);var s=Fe(null==n?void 0:n.entry);return s&&(i.initial_stats_info=s),ze(i).then((function(n){e.flags&&(n=n+"#"+K(e.flags));var o=screen.height/2-280,i=screen.width/2-410,a=window.open(n,"_blank","top="+o+",left="+i+",width=820,height=560,location");if(!a){var s=Ee(ye(z[z.CONNECT_WINDOW_NOT_OPENED],z.CONNECT_WINDOW_NOT_OPENED,Q()));return Promise.reject(s)}return new Promise((function(e,n){var o=setInterval((function(){if(!a||a.closed){window.removeEventListener("message",i),clearInterval(o);var e=Ee(ye(z[z.CONNECT_WINDOW_CLOSED],z.CONNECT_WINDOW_CLOSED,J()));n(e)}}),1e3);function i(s){if(s.source===a&&a)if(window.removeEventListener("message",i),clearInterval(o),function(e){for(var n=0;n<t.length;n++){var r=t[n];if(e.slice(e.length-r.length)===r)return!0}return!1}(s.origin))if(s.data.action==="vk_connect_response"+r){var c=s.data.payload;if(a.close(),c.error){l=Ee(ye(z[z.CONNECT_CLIENT_SDK_ERROR],z.CONNECT_CLIENT_SDK_ERROR,ee(c.error)));n(l)}else e({provider:"vk",payload:c})}else if(s.data.action==="oauth_callback"+r)e({provider:s.data.payload.name}),a.close();else if(s.data.action==="skip_callback"+r){var u=s.data.payload.redirectURL;u&&(window.location.href=u),a.close()}else if(s.data.action==="bind_ok_account"+r)e(s.data.payload),a.close();else{a.close();l=Ee(ye(z[z.CONNECT_UNKNOWN_SDK_MESSAGE],z.CONNECT_UNKNOWN_SDK_MESSAGE,$(JSON.stringify(s.data))));n(l)}else{a.close();var l=Ee(ye(z[z.CONNECT_DOMAIN_NOT_ALLOWED],z.CONNECT_DOMAIN_NOT_ALLOWED,X(s.origin)));n(l)}}window.addEventListener("message",i)}))}))}))},e.redirectAuth=function(e){var t=lt.validate(e);!t.isValid()&&console.error(t.error());var n=e.code_verifier?{code_challenge:j(e.code_verifier),code_challenge_method:"s256"}:{},r=I(),o=he(he(he({redirect_uri:e.url,uuid:r},B(e,["screen","source"])),{scheme:null==e?void 0:e.scheme}),n),i=We(null==e?void 0:e.action);i&&(o.action=i);var a=Fe(null==e?void 0:e.entry);a&&(o.initial_stats_info=a),(null==e?void 0:e.state)&&(o.redirect_state=e.state),ze(o).then((function(e){location.assign(e)}))},e.logout=function(){return Ke.fetchDomain().then((function(){var e=Ke.get(),t=e.connectDomain,n=e.appId,r=e.superAppTokenV2;if(!r)return Promise.reject(Z("superappToken","SuperappToken is undefined"));var o=K({origin:location.protocol+"//"+location.host,host_app_id:n,superapp_token:r}),i=fetch("https://"+t+"/logout?"+o,{credentials:"include"});return Ke.events.emit(W.LOGOUT),Ke.setSuperAppToken(""),Ke.setSuperAppToken("",{version:2}),i}))},e}(),yt={OneTapAuthEventsSDK:ot,FloatingOneTapAuthEventsSDK:it,ButtonOneTapAuthEventsSDK:at,DataPolicyEventsSDK:nt},At=["open_account"];var Et,Tt,St=function(){function e(){}return e.open=function(e){var t=we.validate({token:e.action.token});return!t.isValid()&&console.error(t.error()),Ke.fetchDomain().then((function(){var t,n=I(),r=Ke.get(),o=he({origin:location.protocol+"//"+location.host,uuid:n,debug:G(r._debug,0),localhost:G(r._localhost,0)},B(e,["screen","source"])),i=(t=null==e?void 0:e.action)&&At.includes(t.name)?btoa(JSON.stringify(t)):"";return i&&(o.action=i),function(e){return Ke.fetchDomain().then((function(){var t=Ke.get(),n=t.appId,r=t.connectDomain,o=t.appSettings,i=t._debug,a=t._localhost,s=he({app_id:n,response_type:"silent_token",v:"1.60.0",debug:i?1:null,localhost:a?1:null},e);o&&L(o)&&(s.app_settings=V(o));var c=K(s);return Promise.resolve("https://"+r+"/open_account?"+c)}))}(o).then((function(e){if(!window.open(e,"_blank")){var t=Ee(ye(z[z.CONNECT_WINDOW_NOT_OPENED],z.CONNECT_WINDOW_NOT_OPENED,Q()));return Promise.reject(t)}return Promise.resolve()}))}))},e}();!function(e){e.INTERNAL_RESIZE="VKSDKMessengerInternalResize",e.INTERNAL_LOGOUT="VKSDKMessengerInternalLogout"}(Et||(Et={})),function(e){e.CLOSE_CHAT="VKSDKMessengerCloseChat"}(Tt||(Tt={}));var Ot,wt=new Oe({config:[{rule:ge,errorText:oe("config")}]}),Ct={styles:{bottom:"0",right:"0",zIndex:99999}},bt=function(e){function t(t){var n=e.call(this)||this;n.config=Ct,n.cssText="\n    border: none;\n    display: none;\n    position: fixed;\n    color-scheme: auto;\n  ",n.updateStyles=function(){if(n.iframe){var e=n.config.styles,t=isFinite(e.zIndex)?e.zIndex:999999;n.iframe.style.zIndex=""+t,n.iframe.style.bottom=e.bottom,n.iframe.style.right=e.right}};var r=wt.validate({config:t});return!r.isValid()&&console.error(r.error()),n.updateConfig(t),n}return ce(t,e),t.prototype.handleBridgeMessage=function(t){var n=this;switch(e.prototype.handleBridgeMessage.call(this,t),t.handler){case W.GET_CAPTCHA:var r=t.params.uuid,o=new $e(r,{captcha_sid:t.params.captcha_sid,captcha_img:t.params.captcha_img});o.show().then((function(e){n.bridge.sendMessage({handler:W.GET_CAPTCHA+"Success",params:he({uuid:r},e)})})).catch((function(){n.bridge.sendMessage({handler:W.GET_CAPTCHA+"Fail",params:{uuid:r}}),o.destroy()}));break;case Et.INTERNAL_RESIZE:this.handleInternalIframeResize(t);break;case Et.INTERNAL_LOGOUT:this.handleLogout();break;case Tt.CLOSE_CHAT:this.events.emit(Tt.CLOSE_CHAT,t.params);break;default:return}},t.prototype.handleInternalIframeResize=function(e){var t=e.params;this.iframe.width=t.width+"px",this.iframe.height=t.height+"px"},t.prototype.handleAfterUpdateConfig=function(){this.updateStyles()},t.prototype.handleAfterCreateIframe=function(){this.updateStyles()},t.prototype.validateParams=function(e){return e.peer_id>=0?Promise.reject(Z("peer_id","Peer id can`t be positive")):Promise.resolve(e)},t.prototype.getIframeUrl=function(){var e=this;return Ke.fetchDomain().then((function(){return e.getIframeUrlParams().then((function(e){var t=Ke.get().connectDomain;return Promise.resolve("https://"+t+"/messenger?"+e)}))}))},t}(mt);!function(e){e.SCANNED="VKSDKQRScaned",e.CLICKED="VKSDKQRClicked"}(Ot||(Ot={}));var Pt,Dt=new Oe({container:[{rule:ge,errorText:oe("container")}]}),It=function(e){function t(t){var n=e.call(this)||this;n.getIframeContainer=function(){return n.config.container?n.config.container:window.document.body};var r=Dt.validate(t);return!r.isValid()&&console.error(r.error()),(null==t?void 0:t.langId)&&!Ye.includes(null==t?void 0:t.langId)&&console.error(Z("lang_id","This lang id is not allowed")),n.updateConfig(t),n}return ce(t,e),t.prototype.getIframeUrl=function(){return this.getIframeUrlParams().then((function(e){var t=Ke.get().connectDomain;return Promise.resolve("https://"+t+"/qr_auth?"+e)}))},t.prototype.getIframeUrlParams=function(){var e=this;return Ke.fetchDomain().then((function(){var t,n=Ke.get(),r=n.appId,o=n._debug,i=n._localhost;return Promise.resolve(K({scheme:(null===(t=e.params)||void 0===t?void 0:t.scheme)||"bright_light",app_id:r,origin:location.protocol+"//"+location.host,lang_id:e.config.langId||null,initial_stats_info:Fe(e.config.entry)||null,debug:o?1:null,localhost:i?1:null}))}))},t.prototype.handleBridgeMessage=function(t){var n=this;switch(e.prototype.handleBridgeMessage.call(this,t),t.handler){case Ot.CLICKED:this.events.emit(Ot.CLICKED);break;case Ot.SCANNED:this.events.emit(Ot.SCANNED,t.params.token);break;case W.GET_CAPTCHA:var r=t.params.uuid,o=new $e(r,{captcha_sid:t.params.captcha_sid,captcha_img:t.params.captcha_img});o.show().then((function(e){n.bridge.sendMessage({handler:W.GET_CAPTCHA+"Success",params:he({uuid:r},e)})})).catch((function(){n.bridge.sendMessage({handler:W.GET_CAPTCHA+"Fail",params:{uuid:r}}),o.destroy()}));break;default:return}},t}(mt);!function(e){e.CONTENT_IN_HEIGHT="VKSDKUserContentInHeight",e.VALIDATION_PHONE_CLOSE="VKSDKUserValidationPhoneClose"}(Pt||(Pt={}));var Nt,kt=new Oe({container:[{rule:ge,errorText:oe("container")}]}),Rt=new Oe({canSkip:[{rule:ge,errorText:oe("canSkip")}],origin:[{rule:ge,errorText:oe("origin")}]}),xt=function(e){function t(t){var n=e.call(this)||this;n.getIframeContainer=function(){return n.config.container?n.config.container:window.document.body};var r=kt.validate(t);return!r.isValid()&&console.error(r.error()),n.updateConfig(t),n}return ce(t,e),t.prototype.getIframeUrl=function(){var e=he(he({redirect_uri:this.params.url,uuid:I()},B(this.params,["screen","source"])),{scheme:this.params.scheme}),t=We(this.params.action);t&&(e.action=t);var n=Fe(this.params.entry);return n&&(e.initial_stats_info=n),this.params.state&&(e.redirect_state=this.params.state),ze(e)},t.prototype.handleBridgeMessage=function(t){switch(e.prototype.handleBridgeMessage.call(this,t),t.handler){case Pt.CONTENT_IN_HEIGHT:this.events.emit(Pt.CONTENT_IN_HEIGHT,t.params);break;case Pt.VALIDATION_PHONE_CLOSE:this.events.emit(Pt.VALIDATION_PHONE_CLOSE,t.params);break;default:return}},t.prototype.validatePhone=function(e){var t=Rt.validate(e);!t.isValid()&&console.error(t.error());var n={name:"auth_validation_phone",params:{status:e.canSkip?"1":"0"}};e.sid&&(n.params.sid=e.sid),this.open({url:e.origin,scheme:e.scheme,action:n})},t}(mt);!function(e){e.SUCCESS="VKSDKVerificationProfileSuccess",e.CLOSE="VKSDKVerificationProfileClose"}(Nt||(Nt={}));var Kt=new Oe({config:[{rule:ge,errorText:oe("config")}],provider:[{rule:ve,errorText:re("provider")},{rule:ge,errorText:oe("provider")}]}),Mt=function(e){function t(t){var n=e.call(this)||this;n.cssText="\n    position: fixed;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 9999;\n    border: none;\n    display: none;\n  ";var r=Kt.validate({config:t,provider:t.provider});return!r.isValid()&&console.error(r.error()),n.updateConfig(t),n}return ce(t,e),t.prototype.handleBridgeMessage=function(t){switch(e.prototype.handleBridgeMessage.call(this,t),t.handler){case Nt.SUCCESS:this.events.emit(Nt.SUCCESS);break;case Nt.CLOSE:this.close();break;default:return}},t.prototype.handleAfterUpdateConfig=function(){this.updateZIndex()},t.prototype.handleAfterCreateIframe=function(){this.updateZIndex()},t.prototype.getIframeUrlParams=function(){var e=this;return Ke.fetchDomain().then((function(){var t=Ke.get(),n=t.superAppTokenV2,r=t.appId,o=t._debug,i=t._localhost;return Promise.resolve(K(he(he({},e.params),{app:r,superapp_token:n,origin:location.protocol+"//"+location.host,debug:o?1:null,localhost:i?1:null,provider:e.config.provider})))}))},t.prototype.getIframeUrl=function(){var e=this;return Ke.fetchDomain().then((function(){return e.getIframeUrlParams().then((function(e){var t=Ke.get().connectDomain;return Promise.resolve("https://"+t+"/verification_profile?"+e)}))}))},t.prototype.updateZIndex=function(){if(this.iframe){var e=this.config.zIndex;this.iframe.style.zIndex=""+e}},t}(mt);export{St as Account,Qe as AuthCaptchaEventsSDK,It as AuthQR,Ot as AuthQREvents,gt as Authorize,ut as AuthorizeEvents,q as BodyOverflowManager,at as ButtonOneTapAuthEventsSDK,W as CommonSDKEvents,Ke as Config,_t as Connect,yt as ConnectEvents,nt as DataPolicyEventsSDK,it as FloatingOneTapAuthEventsSDK,ct as GeoService,Xe as GeoserviceEvents,bt as Messenger,Tt as MessengerEvents,et as MiniApp,le as MiniAppEvents,tt as MiniAppService,ot as OneTapAuthEventsSDK,z as SDKErrorCodes,xt as User,Pt as UserEvents,Mt as VerificationProfile,Nt as VerificationProfileEvents};
